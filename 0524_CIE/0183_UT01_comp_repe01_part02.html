<!DOCTYPE html>
<head>
    <title id="titol"></title>
    <link rel="icon" type="image/x-icon" href=img/favicon.png>
    <meta charset="UTF-8">

    <style>

    li.preg {
        display: flex;
        align-items: flex-start;
        gap: 0.5em;
        text-align: justify;
        text-justify: inter-word;

    }
    p, li{
        text-align: justify;
        text-justify: inter-word;
    }
    img[alt="segell"]{
        position: absolute;
        z-index: 2;
    }
    .bgtxt{
        position: relative;
        z-index: 1;
    }
    </style>
</head>

<script>
window.texme = {
    renderOnLoad: false,
    MarkdownURL: '../js/marked/marked.min.js',
    MathJaxURL: '../js/mathjax/es5/tex-mml-chtml.js'
}
</script>
<script src="../js/texme/texme.js"></script>

<textarea id="enunciat">

Introdueix aquí la teva permutació: <br/>
[[i1]]

Introdueix aquí la teva resposta: <br/>
[[i2]]

</textarea>



<script>

const titol = "Comprovador del test de la UT01 (recuperació) - part 02";
const puntuacions = ["",
];

let txtav = "";
let pts = 0;
let ptsTotals = 0;

const preguntes = [
[
"Actualment els conductors de coure nu estan prohibits?",
"No estan prohibits els existents, però atenent exclusivament l'REBT (no la NRZ002, per exemple) no se'n poden instal·lar de nous",
"No estan prohibits, i atenent exclusivament l'REBT (no la NRZ002, per exemple) encara se'n podrien instal·lar",
"Atenent exclusivament l'REBT (no la NRZ002, per exemple) no se'n poden instal·lar de nous, i els existents s'han d'anar retirant en un termini no superior a 4 anys des de la connexió d'algun nou suministre a elles",
"Només estan permesos per a XSBT",
],

[
"A l'empresa a la qual treballes li ha tocat treballar a una instal·lació poc habitual a Mallorca (una galeria visitable a l'Aeroport), el director d'obra et consulta si pot aprofitar per passar l'alta tensió, el gas i l'aigua per aquesta galeria. Què li contestaries?",
"Que gas de cap manera, que les línies d'alta tensió sí, però que vagin per l'altra paret i que l'aigua ha d'anar obligatòriament formigonada.",
"Que gas de cap manera, que les línies d'alta tensió sí, però millor que vagin per l'altre paret i que l'aigua millor si no, però qui si no queda més remei ha d'anar a baix de tot i es necessitarà desguàs (<i>desagüe</i> en castellà).",
"Que gas està prohibit, excepte si està a 40 cm si supera els 4 bar en ser un paral·lelisme, la galeria ha d'estar permanentment ventilada (6 vegades per hora), l'alta tensió ha d'anar a so re i a la paret de la dreta, i l'aigua formigonada i per sota. ",
"Marca aquesta si no pots assenyalar cap de les altres",

],

[
"Quants conductors té una xarxa TN-S, una TN-C i una TT, quants conductors connecten a la xarxa i van cap a l'edifici respectivament?",
"TN-S: xarxa 5, entren 5; TN-C: xarxa 4, entren 5; TT: xarxa 4, entren 4",
"TN-S: xarxa 4, entren 4; TN-C: xarxa 4, entren 5; TT: xarxa 5, entren 5",
"TN-S: xarxa 4, entren 5; TN-C: xarxa 5, entren 5; TT: xarxa 4, entren 4",
"Cap de les anteriors.",
],

[
"L'esquema IN no existeix, per què?",
"La primera lletra només pot ser T o N i la segona T o I, per tant, en tot cas seria NI",
"Perquè «I» vol dir que cap part de l'alimentació està posat a terra, «N» vol dir que les masses es connecten a terra a través de l'alimentació. Com pot ser això possible si l'alimentació està aïllada de terra al ser «I»?",
"Perquè en el segle XV, poc després del descobriment d'Amèrica, a Chicago hi va haver un gran nombre de morts a causa d'aquest tipus d'instal·lació",
"Sí que existeix el sistema TN-C-S el reglament també l'anomena IN al punt 1.4.2.3 a) de la ITC-BT 08",
],

[
"Un constructor ha creat un ninxol suficientment gran per albergar 4 CGP, l'edifici en necessita 4 de 250 A, que li aconsellaries?",
"Que les instal·li totes al mateix ninxol, ja que així estalviarà costos de fer més de un ninxol i a més aquest ja està fet.",
"Dividir-los de 2 en 2, ja que el reglament permet agrupaments de 1 o 2.",
"Utilitzar una CGP per nínxol, ja que les cdt de les diferents LGA com a màxim són del 0,5% o 1% (depenent del tipus de CC) i això fa que les poguem atracar a les CC i per tant reduir la cdt.",
"Reglamentariament només se'n pot instal·lar una.",
],






[
"Si tinc una promoció de 15 habitatges de xalets adosats a una parcel·la per xalet (cada xalet son 2 habitatges) quin esquema hauria de seguir?",
"2.2.3 o 2.2.2",
"Exclusivament 2.2.2",
"2.1 o 2.2.1",
"Exclusivament 2.1",
],

[
"Per una LGA de 50 mm² de coure, que circula per tubs encastats a parets no aïllants, que es dirigeix a una única centralització (CC totalment concentrada), sense presència d’harmònics. Quina serà la secció mínima del neutre i la caiguda màxima de tensió? Quina cdt maxima puc permetre per a les DI d'aquesta CC? Puc utilitzar la diferència entre la cdt de la LGA per a utilitzarla a la DI? Puc utilitzar la cdt de la DI per als circuits interiors o viceversa?",
"S<sub>LGA</sub> = 25 mm² – cdt<sub>LGA</sub> = 0,5 %; cdt<sub>DI</sub> = 1 %; No; Si",
"S<sub>LGA</sub> = 25 mm² – cdt<sub>LGA</sub> = 1 %; cdt<sub>DI</sub> = 0,5 %; No; Si",
"S<sub>LGA</sub> = 25 mm² – cdt<sub>LGA</sub> = 0,5 %; cdt<sub>DI</sub> = 1 %; Si; No",
"S<sub>LGA</sub> = 50 mm² – cdt<sub>LGA</sub> = 1 %; cdt<sub>DI</sub> = 0,5 %; No; Si",
],

[
"Quin element del sistema d'instal·lació d'una LGA té més resistència al foc (RF)",
"El conductor",
"El tub",
"Els tallafocs que hi ha cada 3 tres plantes com a mínim",
"Les tapes de registre",
],

[
'Mira la <a href="docs/UT01_recu01_FT_tub.pdf" target="_blank" rel="noopener noreferrer"> fitxa tècnica </a> d\'aquest tipus de tub, podem afirmar que',
"Seria vàlid per a una instal·lació de LGA encastada (<i>empotrada</i> en castellà)",
"Seria vàlid per a una instal·lació de DI en superfície",
"Seria vàlida per a una instal·lació embeguda en formigó",
"No seria vàlida per a una DI enterrada",
],

[
"Una derivació individual que discorre per canal protectora la tapa de la qual només es pot obrir amb l’ajuda d’una eina, pot ser de H07Z1-K(AS) – 450/750 V?",
"Sí, ja que el punt 1 de la ITC-BT-15 em remet a la ITC-BT-21 respecte a sistemes d’instal·lació. I la ITC-BT-21 en el punt 3.1.a admet cable sense coberta de 450/750 V",
"No, perquè (com també l'LGA) ha de ser cable de 0,6/1 kV",
"No s’admeten canals protectores com a sistema de canalització de la derivació individual.",
"Sí, ja que el punt 1 de la ITC-BT-15 em remet a la ITC-BT-21 pel que fa a sistemes d’instal·lació. I la ITC-BT-21 en el punt 3.1.a admet cable sense coberta de 300/500 V",
],






[
"Per a una DI <b>enterrada</b>",
"Si el conductor té aïllament de 450/750 V i compleix la norma UNE 211.002, és vàlid.",
"Si el conductor és H07Z1-K i va entubat, és vàlid.",
"Si el conductor és RZ1-K, és vàlid",
"Marca aquesta si no pots assenyalar cap de les altres",
],

[
"Quina resistivitat tenen les «margas del jurásico»?",
"entre 20 i 100 Ω/m",
"entre 30 i 40 Ω/m",
"entre 100 i 200 Ω/m",
"50 Ω/m",
],

[
"Quina secció normalitzada tindrà, com a mínim, el <b>cable de protecció</b> associat a un circuit a on no es poden descartar la presència d’harmònics amb cablejat de 120 mm² a les fases?",
"120 mm²",
"60 mm²",
"50 mm²",
"70 mm²",
],

[
"Si a un habitatge la separació entre la vitro i la pica (<i>fregadero</i> en castellà) és d'1,3 m puc instal·lar-hi endolls?",
"Sí, sempre que estiguin per sobre del pla de feina",
"Sí, sempre que estiguin per sota del pla de feina",
"No, no compleixen la distància mínima necessària.",
"Marca aquesta si no pots indicar cap de les altres.",
],

[
"Puc instal·lar una bombilla a fals sostre sobre de la dutxa?",
"Sí, ja que seria volum 3 sempre (al ser fals sostre).",
"Depen de l'altura, tant si hi ha fals sostre com no, si és insuficient no es pot instal·lar.",
"Sí, però si es troba al volum 2 ha de tenir transformador o font d'alimentació a fora del volum",
"Marca aquesta si no pots indicar cap de les altres.",
],
];

const solucions_test = [
2, 2, 1, 2, 4,          3, 1, 3, 1, 1, 
3, 2, 4, 1, 3
];
const opcions_test = [1, 2, 3, 4];

let permutacio = "";
const num_preg = solucions_test.length;
const num_resp = opcions_test.length;
ptsTotals = num_preg;

function estableixParametres(){
    array = [/* p01, p02, p03, p04, p05 */]; // actualitzar entre []
    parametres = parametres.concat(array);  // no tocar aquesta línia
}

function calcula(){
    const permutacio = respostes [0];

    const permpreg = permutacio.split("_")[0];
    const permresp = permutacio.split("_")[1].split(".");
    const respostes_alumne = respostes [1].split("");

    const preg_ordenades = obtenirPermutacio(preguntes, permpreg);
    const sol_ordenades = obtenirPermutacio(solucions_test, permpreg);


    for (let i = 0; i < num_preg; i++){
        preg = preg_ordenades[i][0];


        let resp =
         obtenirPermutacio(preg_ordenades[i].slice(1), permresp[i]);

        let pr = permresp[i];
        let opcions_permutades = obtenirPermutacio(opcions_test, pr);


        let st = sol_ordenades[i];
        let opcio_correcta = opcions_permutades.indexOf(st) + 1;
        let opcio_marcada = lletraANombre(respostes_alumne[i]);
        let color = "black";
        let marcador = "";

        if (opcio_correcta === 0) {
            ptsTotals -= 1;
            color = "gray";
            txtav += '\n\n<div>\n'+
             '<p><b>' + (i+1) + '.</b> ' + preg + '</p>' +
             '<img src="img/anul·lada.png" alt="segell"/>\n' +
             '<div class="bgtxt">\n'
        }else{
            txtav += "<p><b>" + (i+1) + '.</b> ' + preg + '</p>';
        }
        txtav += '<ol style="list-style-type: none;">\n';


        for (let j = 0; j < num_resp; j++){
            a = j + 1;
            if (opcio_correcta === 0){
                color = "gray";
            } else if (a === opcio_correcta && a === opcio_marcada){
                color = "green";
                marcador = "⇦";
                pts += 1;
            } else if (a === opcio_correcta && a != opcio_marcada){
                marcador = "⇦";
            } else if (a != opcio_correcta && a === opcio_marcada){
                color = "red";
                pts -= 1/(num_resp-1);
            } else if (a != opcio_correcta && a != opcio_marcada){
            }
            txtav += '<li class="preg"><span style="color: ' +
             color + ';"><i>' + nombreALletra(j+1) + '</i>) </span><span style="flex: 1; color: ' + color + ';">' +
             resp[j] + marcador + "</span></li>"
            color = "black";
            marcador = "";
        } // fi for respostes
        if (opcio_correcta === 0) {
            txtav += '</div>\n</div></ol><br/>\n\n'
        }else{
            txtav += "</ol>\n";
        }
    } // fi for preguntes
} //fi calcula();

let txtEnunciat = "";   // l'enunciat de l'apartat B.
let parametres = [""];  // els paràmetres del punt 3.1.
let solucions = [""];   // els valors que ha donat el programa.
let respostes = [""];   // els valors que ha donat l'alumne.
let alumne = {
    nom: "",
    cicle: "CFGS Técnic Superior en sistemes electrotècnics i automatitzats",
    anys: "2025/2026"
}
let tlog = "";          // log que apareix al final de l'avaluació.

window.onload = function (){
    // txtEnunciat és una variable global
    txtEnunciat = document.getElementById("enunciat").value;
    renderEnunciat(txtEnunciat);
}

function renderEnunciat(){
    let txt = "";
    estableixParametres();
    txt = '<h1 align ="center">' + titol + "</h1>\n&nbsp;\n\n" +
          txtEnunciat;
    txt = exportarParametres(txt);
    txt = crearInputs(txt);
    txt = crearIdentificacio(txt);
    document.getElementById("enunciat").innerHTML = txt;
    document.getElementById("titol").innerText = titol;
    texme.renderPage();
}

function exportarParametres(txt){
    let patro = "", canvi = "";
    const fi = parametres.length;
    for (let i = 1; i < parametres.length; i++) {
        patro = "[[p" + i +"]]";
        canvi = l(parametres[i]);
        txt = txt.replace(patro, canvi);
    }
    return txt;
}

function crearInputs(txt){
    let patro = "", canvi = "";
    patro = "[[i1]]";
    canvi = '<input type="text" onwheel="return false;" ';
    canvi += 'id="i1" style="width: 300px">';
    txt = txt.replace(patro, canvi);
    patro = "[[i2]]";
    canvi = '<input type="text" onwheel="return false;" ';
    canvi += 'id="i2" style="width: 300px">';
    txt = txt.replace(patro, canvi);
    /*for (let i = 1; i < puntuacions.length; i++) {
        patro = "[[i" + i +"]]";
        canvi = '<input type="text" onwheel="return false;" ';
        canvi += 'id="i'+ i +'" style="width: 300px">';
        txt = txt.replace(patro, canvi);
    }*/
    return txt;
}

function crearIdentificacio(txt){
txt += `
<h2>Identificació de l'alumne</h2>

<form id="avalua" onsubmit="event.preventDefault() & avalua()">
    <label>Nom de l'alumne: </label>
    <input id="nom" style="width: 400px"/>
    <div>
        <input type="checkbox" id="informat" required/>
        <label>
            Entenc que al premer el botó avaluar no es pot tornar
            enrera.
        </label>
    </div>
    <br/>
    <div style="text-align: center;">
        <button type="submit" id="boto"
            style="font-size: 20px; color: #AA5050;">
            Avaluar
        </button>
    </div>
</form>
`; return txt;
}

function avalua(){
    importaRespostes();
    resetejar();
    renderAvaluacio();
}

function importaRespostes(){
    respostes[0] = document.getElementById("i1").value;
    respostes[1] = document.getElementById("i2").value;
    alumne.nom = document.getElementById("nom").value;
}

function resetejar(){
    const ppal = document.getElementsByTagName("main")[0];
    const body = ppal.parentNode;
    const textArea = body.appendChild(document.createElement("textarea"));
    body.removeChild(ppal);
    textArea.setAttribute("id", "avaluacio");
}

function renderAvaluacio(){
    let txt = "";
    txt += '<h1 align="center"> Avaluació</h1>\n' +
           '<h2 align="center" style="color: #888">' + titol +
           "</h2>\n&nbsp;\n\n"
    txt += [
    "## Presentació de resultats",
    "",
    "L'alumne **[[nom]]**, del [[cicle]] (any [[any]]) ha obtingut una",
    "qualificació de:",

    "> [[nota]]"
    ].join("\n") + "\n\n\n";

    txt = identificarAlumne(txt);
    txt = puntua(txt);

    console.log(txt);
    document.getElementById("avaluacio").innerHTML = txt;
    texme.renderPage();
}

function identificarAlumne(txt){
    txt = txt.replace("[[nom]]", alumne.nom);
    txt = txt.replace("[[cicle]]", alumne.cicle);
    txt = txt.replace("[[any]]", alumne.anys);
    return txt;
}

function puntua(txt){
    calcula();

    txt += txtav;

    let ptsAlumne = pts;
    let canvi = "", patro = "";
    if(ptsAlumne <= 0.01) ptsAlumne = 0;
    txt = txt.replace("[[nota]]", "S'han aconseguit: "+ xs(ptsAlumne, 2) +
        " punts de " + xs(ptsTotals, 2) + " possibles.\n>\n>" +
        "**Nota final: " + xs(ptsAlumne/ptsTotals*10, 2) + "**");

    return txt;
}

function aleat(min, max) { // enter aleat entre min i max (inclosos)
    const a = Math.ceil(min);
    const b = Math.floor(max);
    const c = Math.floor(Math.random() * (b - a + 1) + a);
    return c;
}

function triaElementMatriu (matriu){
    const aleat = Math.floor(Math.random() * (matriu.length));
    return matriu[aleat.toFixed(0)];
}

function factorial(n) {
    return n <= 1 ? 1 : n * factorial(n - 1);
}

// Funció per obtenir la permutació d'un índex específic
function obtenirPermutacio(array, index) {
    let permutacio = [];
    let elements = array.slice(); // Copia de l'array per a evitar
                                  // modificar l'original
    let n = elements.length;

    // Calcular la permutació utilitzant factorials
    for (let i = 0; i < n; i++) {
        let fact = factorial(n - i - 1);
        let posicio = Math.floor(index / fact);
        permutacio.push(elements[posicio]);
        elements.splice(posicio, 1);
        index %= fact;
    }

    return permutacio;
}

function permutacions(array) {

    let resultat = [];

    // Funció recursiva per a generar les permutacions
    function generarPermutacions(actual, resta) {
        if (resta.length === 0) {
            resultat.push(actual);
        } else {
            for (let i = 0; i < resta.length; i++) {
                let actualNova = actual.concat(resta[i]);
                let restaNova = resta.slice(0, i).concat(resta.slice(i + 1));
                generarPermutacions(actualNova, restaNova);
            }
        }
    }

    generarPermutacions([], array);
    return resultat;
}


function atan(a){
    return Math.atan(a)*360/2/π;
}

function sin(a){
    return Math.sin(a*2*π/360);
}

function cos(a){
    return Math.cos(a*2*π/360);
}

function ln(a){
    return Math.log(a);
}

function cbi(x, y){ //complexe input en binomial
    const c = {};
    c.r = (x**2 + y**2)**0.5;
    c.φ = Math.atan2(y, x)*360/2/π;
    c.x = x;
    c.y = y;
    return c;
}

function cpol(r, φ){ //complexe input en polar (φ en graus)
    const c = {};
    c.r = r;
    c.φ = φ;
    c.x = r * cos(φ);
    c.y = r * sin(φ);
    return c;
}

function sumc(a, b){
    return cbi(a.x + b.x, a.y + b.y)
}

function restc(a, b){
    return cbi(a.x - b.x, a.y - b.y)
}

function multc(a, b){
    return cpol(a.r*b.r, a.φ+b.φ);
}

function multc_esc(λ, a){
    return cpol(λ*a.r, a.φ);
}

function divc(a, b){
    return cpol(a.r/b.r, a.φ-b.φ);
}

function invc(a){ // inversa d'un complexe
    return cpol(1/a.r, -a.φ);
}

function logc (nom, v){ // log d'un nombre complexe
    let log = "";
    log += nom + ": ";
    log += xs(v.x);
    if (v.y > 0) log += " + j" + xs(v.y);
    else if (v.y < 0) log += "-j" + xs(-v.y);
    log += "; ";
    log += xs(v.r) + "∠" + xs(v.φ) + "°\n";
    log = coma(log);
    return log;
}

function logcbi (v){ // log d'un nombre complexe només en binomial
    let log = "";
    log += xs(v.x);
    if (v.y > 0) log += " + j" + xs(v.y);
    else if (v.y < 0) log += "-j" + xs(-v.y);
    log = coma(log);
    return log;
}

function l(a){  // log abreviat a l totsol
    if (!a.toPrecision) return a;
    return coma(xs(a));
}

function ll(a, b = 4){ // log Latex
    return cl(xs(a, b));
}

function xs(a, b = 4){
    a = Number(a);
    if (a.toPrecision) a = a.toPrecision(b);
    return Number(a);
}

function coma(a){
    a = a + "";
    return a.replaceAll(".", ",");
}

function cl(a){ // coma per a latex
    return coma(a).replaceAll(",", "{,}");
}

function xsMap(a){
    a = xs(a);
    return a;
}


function nombreALletra(nombre) {
    const ascii = 97; // Codi ASCII de 'a'
    if (nombre >= 1 && nombre <= 26) {
        // Convertir el nombre en el caràcter corresponent utilitzant el codi ASCII
        return String.fromCharCode(ascii + nombre - 1);
    } else {
        return null; // Retornar null si el nombre està fora de rang
    }
}

function lletraANombre(lletra){
    return lletra.toLowerCase().charCodeAt(0) - 96;
}

</script>
