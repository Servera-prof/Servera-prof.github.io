<!DOCTYPE html>
<head>
    <title id="titol"></title>
    <link rel="icon" type="image/x-icon" href=../img/favicon.png>
    <meta charset="UTF-8">
    
    <style>

    li.preg {
        display: flex;
        align-items: flex-start;
        gap: 0.5em;
        text-align: justify;
        text-justify: inter-word;

    }
    p, li{
        text-align: justify;
        text-justify: inter-word;
    }
    </style>
</head>

<script>
window.texme = {
    renderOnLoad: false,
    markdownURL: 'js/marked/marked.min.js',
    MathJaxURL: 'js/mathjax/es5/tex-mml-chtml.js'
}
</script>
<script src="js/texme/texme.js"></script>

<textarea id="enunciat">
~~~
&nbsp;
    Permutació: [[p2]]
&nbsp;
~~~

Puntuació: 35%

## Normes:

- S'ha de **gravar la pantalla COMPLETA**, sense micròfon, webcam ni so.
  Pots utilitzar la web
  [Screen Capture](https://www.screencapture.com/es/)
- No es poden utilitzar apunts.
- Només es pot tenir una finestra oberta (la del navegador Chrome).
- Només es pot tenir una pestanya oberta (la de l'examen).
- Està terminantment prohibit copiar o mirar al company.
- No es poden fer preguntes. Part de l'avaluació és la comprensió del
  text. Si hi ha algun error es parlarà una vegada l'examen hagi
  finalitzat, i en el seu cas s'anul·larà la pregunta.
- L'examen dura el que indiqui la tasca associada i **es tanca
  automàticament**. ENTREGUEU-HO ABANS o serà un zero.
- Qualsevol incompliment serà sancionat amb un zero.
- Les preguntes correctes sumen 1 punt, les incorrectes resten
  1/(numrespostes - 1) punts, les que es deixen en blanc, ni sumen
  ni resten.

## Com fer aquest examen:

- Agafa paper
- **Escriu la permutació al paper!!**
- Comença a escriure les respostes al paper.
- Si una resposta es vol deixar en blanc escriu una n.
- Quan acabis copia les respostes sense espais i tot seguit, al camp
  «resposta», si no la saps n. Per exemple: abnaac
- Omple el teu nom i clica a avaluar.
- **Imprimeix la pàgina com a pdf fent «Ctrl + P»**
- Adjunta-la com a tasca.
- Fotografia el paper utilitzat (la fotografia és per a tu, per a
  poder revisar l'examen si ho necessitessis).
- Entrega els papers utilitzats.

## Preguntes

[[p1]]

## Resposta

[[i1]]
</textarea>

<script>

const titol = "Test UT01 - sense suport";
const puntuacions = ["", 10];

let p01 = "";
const preguntes = [
[
"Es té una connexió de servei (<i>acometida</i> en castellà) subterrania, que surt d'una caixa de seccionament, i que arriba a una caixa, com es diu auqesta caixa? Quants cables sortiran d'aquesta capsa i com seran visualment? On arribaran? <b>Tria la resposta que no contengui CAP afirmació falsa</b>",
"La caixa és una CGP, de la qual poden sortir 4 cables si és unipolar i un si és multipolar de color verd (no propagadors de l'incendi i amb emisió de fums i  opacitat reduïda de 0,6/1 kV), arribaran a la centralització de comptadors",
"La caixa és una caixa de seccionament privada, de la qual poden sortir 4 cables (o 5 si també du la terra) de color verd (no propagadors de l'incendi i amb emisió de fums i  opacitat reduïda de 0,6/1 kV), arribaran a la centralització de comptadors o a una CPM (si és un o dos usuaris)",
"La caixa és una CGP, de la qual poden sortir 4 cables de color verd (no propagadors de l'incendi i amb emisió de fums i  opacitat reduïda de 0,6/1 kV), arribaran a la centralització de comptadors",
"La caixa és una CGP, de la qual poden sortir 1 cable de color verd (no propagadors de l'incendi i amb emisió de fums i  opacitat reduïda de 0,6/1 kV), arribaran a l'IGA de la CC",
],

[
"En que s'assemblen i en que es diferencien els esquemes TT, TN i IT? <b>Tria la resposta que no contengui CAP afirmació falsa</b>",
"Tan en el TT com en l'IT les masses estan connectades a terra, mentre que el TN no té masses a terra",
"Tan en el TT com en l'TN les masses estan connectades a terra, mentre que el IT no té masses a terra",
"Tan en el TT com en l'IT el neutre està connectat a terra, mentre que el TN el neutre no esta connectat a terra",
"Marca aquesta resposta si no pots marcar cap de les altres.",
],

[
"Si observo una CGP en superfície (fora de nínxol) a Caimari, puc assegurar que?",
"És una CGP-7 (entrada i sortida per abaix)",
"És una CGP-9 (entrada per abaix i sortida per adalt).",
"Té el neutre a la dreta.",
"El fusible del neutre té la meitat de la intensitat dels conductors de fase.",
],

[
"Quina afirmació és certa?",
"Els conductors de la DI individual, si són unipolars només poden ser H07Z1-K",
"Els conductors de la DI individual, si són monofàsics només poden ser RZ1-K",
"Els conductors de la DI individual, si estan encastats directament a paret sense tub poden ser tant H07Z1-K con RZ1-K",
"Marca aquesta resposta si no pots marcar cap de les altres.",
],

[
"Quin dels següents tubs <b>NO</b> cal que sigui «no propagador de la llama»",
"Els enterrats de XSBT",
"Els de les DI del habitatgel",
"Els de les DI de locals de pública concurrència",
"Els dels circuits interiors dels habitatges",
],







[
"Quin d'aquest circuits no té secció mínima?",
"XSBT",
"LGA",
"DI",
"Marca aquesta resposta si no pots marcar cap de les altres.",
],

[
"Si vull desconectar la terra de tota la CC a Villalba de los Barros (provincia de Badajoz) ho faré? per mesurar la resistència de l'elèctrode de terra, com ho faré",
"Mai es pot desconnectar la terra",
'Deixant l\'edifici complet sense tensió, i utilitzant l\'element de la següent imatge <br/><img src="img/repeUT01_01.png" width=300px">',
"Amb la cutxilla del neutre (que està connectat a terra) després de deixar sense tensió les fases",
"Marca aquesta resposta si no pots marcar cap de les altres.",
],
[
"Si un fabricant m’indica que un tub és ø160 vol dir que",
"El seu diàmetre exterior és de 160 mm.",
"El seu diàmetre interior és de 160 mm.",
"Que el seu diàmetre permet un conductor de 160 mm.",
"Que el seu diàmetre interior és de 160 cm.",
],
[
"Quants de circuits com a màxim puc instalar aigües avall del diferencial d'un habitatge?",
"5 sempre",
"9 si subdivideixo el circuit C4",
"5 si el diferencial és de 300 mA",
"5 sempre que el diferencial no estigui sobrecarregat (pugui passar més intensitat que la del seu calibre)."
],
[
"El Volum 3 d’una dutxa...",
"... és el més restrictiu.",
"... és el menys restrictiu.",
"tots els volums són de 3 dimensions (alt, ample, fons), la pregunta no té sentit.",
"Marca aquesta resposta si no pots marcar cap de les altres.",
],
];


let permutacio = "";
const num_preg = preguntes.length;
const num_resp = preguntes[0].length-1;
const fact_np = factorial(num_preg);
const fact_nr = factorial(num_resp);
/*let ordre_preg = Math.floor(aleat(0, fact_np - 1)/1e16)*/;
let ordre_preg = aleat(0, fact_np - 1);

console.log(ordre_preg)
permutacio += ordre_preg + "_";
//ordre_preg *= 1e16;

const preg_ordenades = obtenirPermutacio(preguntes, ordre_preg);

for (let i = 0; i < num_preg; i++){
    p01 += '<p><b>' + (i+1) + '.</b> ' + preg_ordenades[i][0] + '</p>';
    let ordre_resp = aleat (0, fact_nr - 1);
    permutacio += ordre_resp + ".";

    let resp = obtenirPermutacio(preg_ordenades[i].slice(1), ordre_resp);
    p01 += '<ol style="list-style-type: none;">'
    for (let j = 0; j < num_resp; j++){
        p01 += '<li class="preg"><span><i>' + nombreALletra(j+1) +
               '</i>) </span><span style="flex: 1;">' +
               resp[j] + "</span></li>"
    }
    p01 += "</ol>"
}

p02 = permutacio;





// ## 2.2 FUNCIO (actualitzar) ----------------------------------------
// !!! CONVERTIR si és necessari les unitats a les unitats que requereix
// el nostre enunciat.

function estableixParametres(){
    array = [
      p01, p02
    ];
    parametres = parametres.concat(array);  // no tocar aquesta línia
}




// # 3. CALCULS =======================================================

// ## 3.1 CALCUL VALORS (ACTUALITZAR) ---------------------------------
function calcula(){

}





// # D. ENTRENADOR SERVERI ============================================


// # 1. VARIABLES GLOBALS =============================================

let txtEnunciat = "";   // l'enunciat de l'apartat B.
let parametres = [""];  // els paràmetres del punt 3.1.
let solucions = [""];   // els valors que ha donat el programa.
let respostes = [""];   // els valors que ha donat l'alumne.
let alumne = {
    nom: "",
    cicle: "CFGS Técnic Superior en sistemes electrotècnics i automatitzats",
    anys: "2025/2026"
}
let tlog = "";          // log que apareix al final de l'avaluació.



// # 2. FUNCIONS ======================================================




window.onload = function (){
    // txtEnunciat és una variable global
    txtEnunciat = document.getElementById("enunciat").value;
    renderEnunciat(txtEnunciat);
}

function renderEnunciat(){
    let txt = "";
    estableixParametres(); // Va al punt 3.2. de l'apartat C. (script)
    txt = '<h1 align ="center">' + titol + "</h1>\n&nbsp;\n\n" +
          txtEnunciat;
    txt = exportarParametres(txt);
    txt = crearInputs(txt);
    txt = crearIdentificacio(txt);
    document.getElementById("enunciat").innerHTML = txt;
    document.getElementById("titol").innerText = titol;
    texme.renderPage();
}

function exportarParametres(txt){
    let patro = "", canvi = "";
    const fi = parametres.length;
    for (let i = 1; i < parametres.length; i++) {
        patro = "[[p" + i +"]]";
        canvi = parametres[i];
        txt = txt.replace(patro, canvi);
    }
    return txt;
}

function crearInputs(txt){
    let patro = "", canvi = "";
    for (let i = 1; i < puntuacions.length; i++) {
        patro = "[[i" + i +"]]";
        canvi = '<input type="text" onwheel="return false;" ';
        canvi += 'id="i'+ i +'" style="width: 300px">';
        txt = txt.replace(patro, canvi);
    }
    return txt;
}

function crearIdentificacio(txt){
txt += `
<h2>Identificació de l'alumne</h2>

<form id="avalua" onsubmit="event.preventDefault() & avalua()">
    <label>Nom de l'alumne: </label>
    <input id="nom" style="width: 400px"/>
    <div>
        <input type="checkbox" id="informat" required/>
        <label>
            Entenc que al premer el botó avaluar no es pot tornar
            enrera.
        </label>
    </div>
    <br/>
    <div style="text-align: center;">
        <button type="submit" id="boto"
            style="font-size: 20px; color: #AA5050;">
            Avaluar
        </button>
    </div>
</form>
`; return txt;
}

function avalua(){
    importaRespostes();
    resetejar();
    renderAvaluacio();
}

function importaRespostes(){
    respostes[0] = document.getElementById("i1").value
    alumne.nom = document.getElementById("nom").value;
}

function resetejar(){
    const ppal = document.getElementsByTagName("main")[0];
    const body = ppal.parentNode;
    const textArea = body.appendChild(document.createElement("textarea"));
    body.removeChild(ppal);
    textArea.setAttribute("id", "avaluacio");
}

function renderAvaluacio(){
    let txt = "";
    txt += '<h1 align="center"> Avaluació</h1>\n' +
           '<h2 align="center" style="color: #888">' + titol +
           "</h2>\n&nbsp;\n\n"
    txt += [
    "## Presentació de resultats",
    "",
    "L'alumne **[[nom]]**, del [[cicle]] (any [[any]]) serà qualificat manualment.",
    "",
    ].join("\n") + "\n";
    txt += txtEnunciat;

    txt = identificarAlumne(txt);
    txt = puntua(txt);
    txt = txt.replace("## Identificació de l'alumne:\n\n"+
        "[[identificacio]]", "");
    txt +=  "\n" + tlog + "\n";
    document.getElementById("avaluacio").innerHTML = txt;
    texme.renderPage();
}

function identificarAlumne(txt){
    txt = txt.replace("[[nom]]", alumne.nom);
    txt = txt.replace("[[cicle]]", alumne.cicle);
    txt = txt.replace("[[any]]", alumne.anys);
    return txt;
}

function puntua(txt){
    calcula();

    txt = exportarParametres(txt);

    patro = "[[i1]]";
    canvi = "~~~\n    " + respostes[0] + "\n\n\n~~~";

    txt = txt.replace(patro, canvi);

    return txt;
}












function aleat(min, max) { // enter aleat entre min i max (inclosos)
    const a = Math.ceil(min);
    const b = Math.floor(max);
    const c = Math.floor(Math.random() * (b - a + 1) + a);
    return c;
}

function triaElementMatriu (matriu){
    const aleat = Math.floor(Math.random() * (matriu.length));
    return matriu[aleat.toFixed(0)];
}

function factorial(n) {
    return n <= 1 ? 1 : n * factorial(n - 1);
}

// Funció per obtenir la permutació d'un índex específic
function obtenirPermutacio(array, index) {
    let permutacio = [];
    let elements = array.slice(); // Copia de l'array per a evitar
                                  // modificar l'original
    let n = elements.length;

    // Calcular la permutació utilitzant factorials
    for (let i = 0; i < n; i++) {
        let fact = factorial(n - i - 1);
        let posicio = Math.floor(index / fact);
        permutacio.push(elements[posicio]);
        elements.splice(posicio, 1);
        index %= fact;
    }

    return permutacio;
}

function permutacions(array) {

    let resultat = [];

    // Funció recursiva per a generar les permutacions
    function generarPermutacions(actual, resta) {
        if (resta.length === 0) {
            resultat.push(actual);
        } else {
            for (let i = 0; i < resta.length; i++) {
                let actualNova = actual.concat(resta[i]);
                let restaNova = resta.slice(0, i).concat(resta.slice(i + 1));
                generarPermutacions(actualNova, restaNova);
            }
        }
    }

    generarPermutacions([], array);
    return resultat;
}


function nombreALletra(nombre) {
    const ascii = 97; // Código ASCII de 'a'
    if (nombre >= 1 && nombre <= 26) {
        // Convertir el número en el carácter correspondiente usando el código ASCII
        return String.fromCharCode(ascii + nombre - 1);
    } else {
        return null; // Retornar null si el número está fuera de rango
    }
}

</script>
