<!DOCTYPE html>
<head>
    <title id="titol"></title>
    <link rel="icon" type="image/x-icon" href=../img/favicon.png>
    <meta charset="UTF-8">
    
    <style>

    li.preg {
        display: flex;
        align-items: flex-start;
        gap: 0.5em;
        text-align: justify;
        text-justify: inter-word;

    }
    p, li{
        text-align: justify;
        text-justify: inter-word;
    }
    </style>
</head>

<script>
window.texme = {
    renderOnLoad: false,
    markdownURL: 'js/marked/marked.min.js',
    MathJaxURL: 'js/mathjax/es5/tex-mml-chtml.js'
}
</script>
<script src="js/texme/texme.js"></script>

<textarea id="enunciat">
~~~
&nbsp;
    Permutació: [[p2]]
&nbsp;
~~~

Puntuació: 65 %

## Normes:

- S'ha de **gravar la pantalla COMPLETA**, sense micròfon, webcam ni so.
  Pots utilitzar la web
  [Screen Capture](https://www.screencapture.com/es/)
- No es poden utilitzar apunts.
- Només es pot tenir una finestra oberta (la del navegador Chrome).
- Només es pot tenir una pestanya oberta (la de l'examen).
- Està terminantment prohibit copiar o mirar al company.
- No es poden fer preguntes. Part de l'avaluació és la comprensió del
  text. Si hi ha algun error es parlarà una vegada l'examen hagi
  finalitzat, i en el seu cas s'anul·larà la pregunta.
- L'examen dura el que indiqui la tasca associada i **es tanca
  automàticament**. ENTREGUEU-HO ABANS o serà un zero.
- Qualsevol incompliment serà sancionat amb un zero.
- Les preguntes correctes sumen 1 punt, les incorrectes resten
  1/(numrespostes - 1) punts, les que es deixen en blanc, ni sumen
  ni resten.

## Com fer aquest examen:

- Agafa paper
- **Escriu la permutació al paper!!**
- Comença a escriure les respostes al paper.
- Si una resposta es vol deixar en blanc escriu una n.
- Quan acabis copia les respostes sense espais i tot seguit, al camp
  «resposta», si no la saps n. Per exemple: abnaac
- Omple el teu nom i clica a avaluar.
- **Imprimeix la pàgina com a pdf fent «Ctrl + P»**
- Adjunta-la com a tasca.
- Fotografia el paper utilitzat (la fotografia és per a tu, per a
  poder revisar l'examen si ho necessitessis).
- Entrega els papers utilitzats.

## Preguntes

[[p1]]

## Resposta

[[i1]]
</textarea>

<script>

const titol = "Test de la UT01 - part 02";
const puntuacions = ["", 10];

let p01 = "";
const preguntes = [
[
"Els suports de les línies aèries de baixa tensió poden ser de plàstic homologat per a càrregues mecàniques per l’autoritat competent?",
"Sí, sempre que el seu dimensionament sigui correcte.",
"No, són un tipus d’instal·lacions que es feien amb l’anterior reglament. Amb el nou REBT de 2002 no és possible.",
"No, ja que la plàstic és un material combustible i les instal·lacions elèctriques han de ser ignífugues.",
"És la millor opció en tots els casos donat el bon preu del plàstic si es compara amb el formigó.",

],
[
"A quina distància als costats d’una finestra hauria d’estar una xarxa aèria (existent) amb cable aïllat de <b>450/750 V</b>?",
"A 0,5 m",
"A 0 m",
"A 300 cm",
"A 1 m",

],
[
"És correcte que una XSBT enterrada <b>sota tub</b> estigui a 80 cm d’una canonada d’aigua a on hi ha una junta?",
"Sí, ja que està entubada.",
"No, hauria de ser 0,2 m",
"No, hauria de ser 1 m.",
"Sí, ja que 0,8 m ≥ 1 m",

],
[
"A on es connecta el neutre d’un esquema TN-S?",
"A terra com al TT.",
"A un sistema TN (sigui S, C o C-S) cap punt es connecta a terra, però es distribueix el neutre.",
"Un esquema TN-S no té cap punt de l’alimentació a terra, a més no es recomana distribuir el neutre.",
"Cap de les anteriors.",

],
[
"A un esquema TT...",
"Existeixen dues terres diferents, la terra de l’alimentació i la terra de les masses de les instal·lacions interiors.",
"Existeix una única terra, el conductor de protecció (groc-verd) i neutre (blau) van connectades a aquesta.",
"Existeixen dues terres una per l’estructura de l’edifici, i l’altre per les masses dels equips elèctrics.",
"Un esquema TT no té cap punt de l’alimentació a terra, a més no es recomana distribuir el neutre.",

],
[
"De quin calibre serà el fusible de la CGP destinat a protegir el neutre?",
"Del mateix calibre que les fases. Ja que en el pitjor dels casos aquesta es la intensitat màxima que podria circular per ell.",
"De la meitat del calibre que les fases, excepte si hi ha harmònics, ja que pel neutre la tensió de les fases es compensa.",
"No precisa protecció, la connexió entre les dues bornes del neutre a la CGP es farà per mitjà d’un element inamovible.",
"Cap de les anteriors.",

],
[
"L’empresa distribuïdora pot determinar els esquemes de la CGP?",
"No, ja que l’article 14 diu que només pot determinar escomeses, LGAs, CC i DI",
"Sí, ja que el punt 1.2 paràgraf 2 de la ITC-BT-13 l’autoritza.",
"Segons la NRZ103 els esquemes a utilitzar son el CGP-7 i CGP-9",
"Hi ha dues respostes correctes.",

],
[
"Per una LGA de 50 mm² de coure, que circula per tubs encastats a parets no aïllants, que es dirigeix a diferents centralitzacions (CC a més d’un lloc), sense presència d’harmònics. Quina serà la secció mínima del neutre i la caiguda màxima de tensió?",
"25 mm² – 0,5%",
"50 mm² – 0,5%",
"25 mm² – 1%",
"50 mm² – 1%",

],
[
"Quin tipus de cable es pot utilitzar per a una LGA",
"Cablejat 400/750 V no propagadors de l’incendi i amb emissió de fums i opacitat reduïda.",
"Cablejats 0,6/1 kV de PVC negre.",
"Cablejat de 0,6/1 kV no propagadors de l’incendi i amb emissió de fums i opacitat reduïda.",
"Totes les opcions són vàlides sempre que el sistema d’instal·lació es correspongui amb l’elecció.",

],
[
"Es necessita enllumenat d’emergència a un comptador situat a una CPM?",
"No.",
"Sí.",
"Depèn de si es un edifici amb centralització de comptadors a armari o a local.",
"Sí, ja que una CPM s’instal·larà sempre a dins de local.",

],
[
"Una derivació individual que discorre per canal protectora la tapa de la qual només es pot obrir amb l’ajuda d’una eina, pot ser de H07Z1-K(AS) – 450/750V?",
"Sí, ja que el punt 1 de la ITC-BT-15 em remet a la ITC-BT-21 en quan a sistemes d’instal·lació. I la ITC-BT-21 en el punt 3.1.a admet cable sense coberta de 450/750 V",
"No, ja que a l’igual que la LGA ha de ser cable de 0,6/1 kV",
"No s’admeten canals protectores com a sistema de canalització de la derivació individual.",
"Sí, ja que el punt 1 de la ITC-BT-15 em remet a la ITC-BT-21 en quan a sistemes d’instal·lació. I la ITC-BT-21 en el punt 3.1.a admet cable sense coberta de 300/500 V",

],
[
"Cada quantes plantes s’han d’instal·lar elements tallafocs a una D.I.?",
"Cada 2 plantes",
"Cada 3 plantes",
"Cada 4 plantes",
"Cada 5 plantes",

],
[
"Quina es la màxima caiguda de tensió admissible a la derivació individual d'un xalet?",
"0,5 %",
"1 %",
"1,5 %",
"Un xalet no té DI",

],
[
"Quina secció normalitzada tindrà, com a mínim, el <b>cable de protecció</b> associat a un circuit a on no es poden descartar la presència d’harmònics amb cablejat de 120 mm² a les fases?",
"120 mm²",
"60 mm²",
"50 mm²",
"70 mm²",

],
[
"He trobat un tub amb el següent marcatge a la seva fulla de característiques tècniques «432112422010». És apte per al muntatge superficial?",
"Sí.",
"No.",
"Només si utilitzo cablejat 0,6/1kV",
"Cap de les altres respostes és correcta.",

],
[
"Si a un habitatge tinc 3 banys i una cuina, he d'instal·lar un circuit C12?",
"Sí, ja que atès el mínim nombre d’endolls excedeixo el màxim de punts del circuit C5",
"No, ja que segur que no excedeixo el màxim nombre de punts del circuit C5",
"Depèn del nombre d’endolls que instal·li a cada una d’aquestes habitacions.",
"Cap de les altres respostes és correcta.",
],
];

let permutacio = "";
const num_preg = preguntes.length;
const num_resp = preguntes[0].length-1;
const fact_np = factorial(num_preg);
const fact_nr = factorial(num_resp);
/*let ordre_preg = Math.floor(aleat(0, fact_np - 1)/1e16)*/;
let ordre_preg = aleat(0, fact_np - 1);

console.log(ordre_preg)
permutacio += ordre_preg + "_";
//ordre_preg *= 1e16;

const preg_ordenades = obtenirPermutacio(preguntes, ordre_preg);

for (let i = 0; i < num_preg; i++){
    p01 += '<p><b>' + (i+1) + '.</b> ' + preg_ordenades[i][0] + '</p>';
    let ordre_resp = aleat (0, fact_nr - 1);
    permutacio += ordre_resp + ".";

    let resp = obtenirPermutacio(preg_ordenades[i].slice(1), ordre_resp);
    p01 += '<ol style="list-style-type: none;">'
    for (let j = 0; j < num_resp; j++){
        p01 += '<li class="preg"><span><i>' + nombreALletra(j+1) +
               '</i>) </span><span style="flex: 1;">' +
               resp[j] + "</span></li>"
    }
    p01 += "</ol>"
}

p02 = permutacio;





// ## 2.2 FUNCIO (actualitzar) ----------------------------------------
// !!! CONVERTIR si és necessari les unitats a les unitats que requereix
// el nostre enunciat.

function estableixParametres(){
    array = [
      p01, p02
    ];
    parametres = parametres.concat(array);  // no tocar aquesta línia
}




// # 3. CALCULS =======================================================

// ## 3.1 CALCUL VALORS (ACTUALITZAR) ---------------------------------
function calcula(){

}





// # D. ENTRENADOR SERVERI ============================================


// # 1. VARIABLES GLOBALS =============================================

let txtEnunciat = "";   // l'enunciat de l'apartat B.
let parametres = [""];  // els paràmetres del punt 3.1.
let solucions = [""];   // els valors que ha donat el programa.
let respostes = [""];   // els valors que ha donat l'alumne.
let alumne = {
    nom: "",
    cicle: "CFGS Técnic Superior en sistemes electrotècnics i automatitzats",
    Anys: "2025/2026"
}
let tlog = "";          // log que apareix al final de l'avaluació.



// # 2. FUNCIONS ======================================================




window.onload = function (){
    // txtEnunciat és una variable global
    txtEnunciat = document.getElementById("enunciat").value;
    renderEnunciat(txtEnunciat);
}

function renderEnunciat(){
    let txt = "";
    estableixParametres(); // Va al punt 3.2. de l'apartat C. (script)
    txt = '<h1 align ="center">' + titol + "</h1>\n&nbsp;\n\n" +
          txtEnunciat;
    txt = exportarParametres(txt);
    txt = crearInputs(txt);
    txt = crearIdentificacio(txt);
    document.getElementById("enunciat").innerHTML = txt;
    document.getElementById("titol").innerText = titol;
    texme.renderPage();
}

function exportarParametres(txt){
    let patro = "", canvi = "";
    const fi = parametres.length;
    for (let i = 1; i < parametres.length; i++) {
        patro = "[[p" + i +"]]";
        canvi = parametres[i];
        txt = txt.replace(patro, canvi);
    }
    return txt;
}

function crearInputs(txt){
    let patro = "", canvi = "";
    for (let i = 1; i < puntuacions.length; i++) {
        patro = "[[i" + i +"]]";
        canvi = '<input type="text" onwheel="return false;" ';
        canvi += 'id="i'+ i +'" style="width: 300px">';
        txt = txt.replace(patro, canvi);
    }
    return txt;
}

function crearIdentificacio(txt){
txt += `
<h2>Identificació de l'alumne</h2>

<form id="avalua" onsubmit="event.preventDefault() & avalua()">
    <label>Nom de l'alumne: </label>
    <input id="nom" style="width: 400px"/>
    <div>
        <input type="checkbox" id="informat" required/>
        <label>
            Entenc que al premer el botó avaluar no es pot tornar
            enrera.
        </label>
    </div>
    <br/>
    <div style="text-align: center;">
        <button type="submit" id="boto"
            style="font-size: 20px; color: #AA5050;">
            Avaluar
        </button>
    </div>
</form>
`; return txt;
}

function avalua(){
    importaRespostes();
    resetejar();
    renderAvaluacio();
}

function importaRespostes(){
    respostes[0] = document.getElementById("i1").value
    alumne.nom = document.getElementById("nom").value;
}

function resetejar(){
    const ppal = document.getElementsByTagName("main")[0];
    const body = ppal.parentNode;
    const textArea = body.appendChild(document.createElement("textarea"));
    body.removeChild(ppal);
    textArea.setAttribute("id", "avaluacio");
}

function renderAvaluacio(){
    let txt = "";
    txt += '<h1 align="center"> Avaluació</h1>\n' +
           '<h2 align="center" style="color: #888">' + titol +
           "</h2>\n&nbsp;\n\n"
    txt += [
    "## Presentació de resultats",
    "",
    "L'alumne **[[nom]]**, del [[cicle]] (any [[any]]) serà qualificat manualment.",
    "",
    ].join("\n") + "\n";
    txt += txtEnunciat;

    txt = identificarAlumne(txt);
    txt = puntua(txt);
    txt = txt.replace("## Identificació de l'alumne:\n\n"+
        "[[identificacio]]", "");
    txt +=  "\n" + tlog + "\n";
    document.getElementById("avaluacio").innerHTML = txt;
    texme.renderPage();
}

function identificarAlumne(txt){
    txt = txt.replace("[[nom]]", alumne.nom);
    txt = txt.replace("[[cicle]]", alumne.cicle);
    txt = txt.replace("[[any]]", alumne.anys);
    return txt;
}

function puntua(txt){
    calcula();

    txt = exportarParametres(txt);

    patro = "[[i1]]";
    canvi = "~~~\n    " + respostes[0] + "\n\n\n~~~";

    txt = txt.replace(patro, canvi);

    return txt;
}












function aleat(min, max) { // enter aleat entre min i max (inclosos)
    const a = Math.ceil(min);
    const b = Math.floor(max);
    const c = Math.floor(Math.random() * (b - a + 1) + a);
    return c;
}

function triaElementMatriu (matriu){
    const aleat = Math.floor(Math.random() * (matriu.length));
    return matriu[aleat.toFixed(0)];
}

function factorial(n) {
    return n <= 1 ? 1 : n * factorial(n - 1);
}

// Funció per obtenir la permutació d'un índex específic
function obtenirPermutacio(array, index) {
    let permutacio = [];
    let elements = array.slice(); // Copia de l'array per a evitar
                                  // modificar l'original
    let n = elements.length;

    // Calcular la permutació utilitzant factorials
    for (let i = 0; i < n; i++) {
        let fact = factorial(n - i - 1);
        let posicio = Math.floor(index / fact);
        permutacio.push(elements[posicio]);
        elements.splice(posicio, 1);
        index %= fact;
    }

    return permutacio;
}

function permutacions(array) {

    let resultat = [];

    // Funció recursiva per a generar les permutacions
    function generarPermutacions(actual, resta) {
        if (resta.length === 0) {
            resultat.push(actual);
        } else {
            for (let i = 0; i < resta.length; i++) {
                let actualNova = actual.concat(resta[i]);
                let restaNova = resta.slice(0, i).concat(resta.slice(i + 1));
                generarPermutacions(actualNova, restaNova);
            }
        }
    }

    generarPermutacions([], array);
    return resultat;
}


function nombreALletra(nombre) {
    const ascii = 97; // Código ASCII de 'a'
    if (nombre >= 1 && nombre <= 26) {
        // Convertir el número en el carácter correspondiente usando el código ASCII
        return String.fromCharCode(ascii + nombre - 1);
    } else {
        return null; // Retornar null si el número está fuera de rango
    }
}

</script>
