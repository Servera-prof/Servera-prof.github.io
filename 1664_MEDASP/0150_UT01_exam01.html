<!-- MOLT IMPORTANT: Al final del document es poden trobar les
instruccions sobre la utilització d'aquesta eina.-->


<!-- A. CAPÇALERA I INITS (NO TOCAR) ============================== -->
<!DOCTYPE html>
<head>
    <title id="titol"></title>
    <link rel="icon" type="image/x-icon" href=img/favicon.png>
    <meta charset="UTF-8">

    <style>
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type=number] {
      -moz-appearance: textfield;
    }

    pre{
        white-space: pre-wrap;
        overflow-wrap: break-word;
    }

    img[alt="c"]{
        display: block;
        margin-left: auto;
        margin-right: auto;
    }
    img[alt="c500"]{
        width: 500px;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }

    img[alt="c250"]{
        width: 250px;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }
    img[alt="250"]{
        width: 250px;
    }
    img[alt="fr250"]{
        width: 250px;
        float: right;
        margin: 0 0 0 0.7em;
    }
    img[alt="fr"]{
        float: right;
        margin: 0 0 0 0.7em;
    }
    img[alt="fl250"]{
        width: 250px;
        float: left;
        margin: 0 .7em 0 0;
    }
    img[alt="fl"]{
        float: left;
        margin: 0 5px 0 0;
    }
    </style>
</head>

<script>
window.texme = {
    renderOnLoad: false,
    markdownURL: 'js/marked/marked.min.js',
    MathJaxURL: 'js/mathjax/es5/tex-mml-chtml.js'
}
</script>
<script src="js/texme/texme.js"></script>

<!-- FI NO TOCAR ================================================== -->




<!-- B. ENUNCIAT ================================================== -->
<textarea id="enunciat">
~~~
&nbsp;
    Permutació: [[p2]]
&nbsp;
~~~


## Preguntes

[[p1]]

## Resposta

[[i1]]



</textarea>
<!-- FI ENUNCIAT ================================================== -->







<!-- C. SCRIPT ==================================================== -->
<script>


// # 1. CONSTANTS (actualitzar) ---------------------------------------
const titol = "Examen UT01 - MEDASP";
const puntuacions = ["",
    10
];
const π = 3.141592654;
const RPRIMA = 287.04;                  // unitats en J/(kg*K)
const KELVIN = 273.15;                  // 0°C = 273,15 K


// # 2. PARÀMETRES ====================================================

// ## 2.1. DECLARACIÓ (actualitzar) -----------------------------------

let p01 = "";
const preguntes = [
    [
    "Per què es va desenvolupar la cultura «d'un sol ús» en el segle XX?",
    "Per la necessitat de crear nous llocs de treball.",
    "Per la falta de consciència sobre els efectes del consumisme.",
    "Per l'escassetat de recursos naturals determinats.",
    "Per la conscienciació social amb el reciclatge i el medi ambient.",
    ],
    [
    "Qué intenta promoure l'economia circular?",
    "Maximitzar el guanys de les empreses.",
    "Emprar recursos naturals de manera ineficient.",
    "Reduir, reutilitzar, reciclar i regenerar productes per a reduir residus.",
    "Generar productes biodegradables.",
    ],
    [
    "L'economia lineal es caracteritza per...",
    "La prolongació de la vida útil dels productes.",
    "L'obtenció de guanys i cerca de l'eficiencia sense considerar els costos socials i mediambientals",
    "El benestar social.",
    "La inversió en nous sistemes de producció sostenibles.",
    ],
    [
    "Quines accions poden dur a terme els consumidors per a practicar un consum més responsable?",
    "Investigar l'origen dels productes que consumim.",
    "Comprar de manera impulsiva per a afavorir la creació de llocs de treball.",
    "No llegir les etiquetes dels productes que comprem.",
    "Ser clients d'empreses que han estat sancionades per les seves males pràctiques.",
    ],
    [
    "Com a principal conseqüencia associada als residus en l'economia lineal es pot destacar:",
    "La contaminació de l'espai aeri per l'acumulació de productes defectuosos.",
    "L'aparició de tendències com el minimalisme o les compres compulsives.",
    "La creació de sistemes de distribució i consum més sostenibles.",
    "L'acumulació de deixalles i la sobreexplotació i l'esgotament de recursos naturals.",
    ],
    [
    "Quina fase de l'economia lineal està relacionada estretament amb la gestió i el tractament de residus?",
    "Extreure.",
    "Produir.",
    "Consumir.",
    "Descartar.",
    ],
    [
    "És una de les accions associades a l'extracció de recursos en l'economia lineal:",
    "L'eliminació de residus en abocadors.",
    "La producció a través de processos industrials que requereixen l'ús de fonts d'energia no renovables.",
    "L'obtenció de matèries primeres com ara minerals, fusta i petroli.",
    "L'eliminació de deixalles a través de grans abocadors.",
    ],
    [
    "No és una de les fases de l'economia lineal",
    "Produir.",
    "Reduir.",
    "Consumir.",
    "Descartar.",
    ],
    [
    "Quines decisions pot dur a terme un govern per a propiciar un model d'economia sostenible?",
    "Fomentar l'ús il·limitat de recursos naturals.",
    "No col·laborar amb el sector i la iniciativa privada.",
    "Destinar recursos a la recerca de tecnologies barates i contaminants.",
    "Legislar per a prohibir comportaments nocius."
    ],
    [
    "Una de les mesures adoptades a Espanya per a reduir el plàstic d'un sol ús és:",
    "La prohibició de les bosses i recipients de plàstic.",
    "El cobrament per les bosses de plàstic als supermercats.",
    "Prohibir la venda de productes biodegradables.",
    "Per ara no s'han adoptat mesures orientades a la reducció de l'ús de plàstic.",
    ],
    [
    "Aproximadament quants litres d'aigua contamina una pila alcalina?",
    "Entre 2 ml i 200 ml",
    "Entre 2 i 200 litres",
    "Entre 20.000 i 200.000 litres",
    "Entre 2.0000 i 200.000 m³",
    ],
    [
    "Quin d'aquest serien exemples d'economia colaborativa?",
    "Blabla Car, espais de coworking.",
    "Cultura empresarial sostenible, energies renovables.",
    "Convenis colaboratius entre empreses per a pactar preus de mercat.",
    "Colaborar amb un company que està malalt i encarregar-nos de fer la seva feina.",
    ],
    [
    "Quina d'aquestes respostes seria un exemple d'accions gubernamentals enfocades a la promoció",
    "Prohibició de l'ús del mercuri.",
    "Destinar recursos a la investigació de tecnologies sostenibles.",
    "Fent promoció de qualsevol cosa, com per exemple el DNI electrònic.",
    "El govern no pot fer aquest tipus d'accions.",
    ],
    [
    "Qué és el programa de la Gran Muralla Verda Africana",
    "Un mur per a evitar que les espècies animals invasores vagin a hàbitats que no els hi pertanyen.",
    "Un mur a Àfrica conseqüencia d'alguns conflictes del passat (similar a la Gran Muralla Xinesa)",
    "Una acció per a evitar la desertificació.",
    "Cap de les altres respostes.",
    ],
    [
    "Quina d'aquestes creus que és una relació entra la revolució industrial i la cultura «d'un sol ús»?",
    "A la revolució industrial es cremava carbó i per tant s'emetien molts de gasos contaminants.",
    "La revolució industrial es va desenvolupar la industria que utilitzava materials nocius com el mercuri o l'urani.",
    "La revolució industrial va provocar un abaratiment i abundancia de bens que feren que la gent comprés productes que ja tenia per a substituir els vells.",
    "La revolució industrial va crear el concepte de elements que només servien per a una cosa (per exemple un obre llaunes només serveis per a obrir llaunes), és a dir productes d'un sol ús",
    ],
];

let permutacio = "";
const num_preg = preguntes.length;
const num_resp = preguntes[0].length-1;
const fact_np = factorial(num_preg);
const fact_nr = factorial(num_resp);
/*let ordre_preg = Math.floor(aleat(0, fact_np - 1)/1e16)*/;
let ordre_preg = aleat(0, fact_np - 1);

console.log(ordre_preg)
permutacio += ordre_preg + "_";
//ordre_preg *= 1e16;

const preg_ordenades = obtenirPermutacio(preguntes, ordre_preg);

for (let i = 0; i < num_preg; i++){
    p01 += "**" + (i+1) + ".**&nbsp;" + preg_ordenades[i][0] + "<br/>";
    let ordre_resp = aleat (0, fact_nr - 1);
    permutacio += ordre_resp + ".";

    let resp = obtenirPermutacio(preg_ordenades[i].slice(1), ordre_resp);
    for (let j = 0; j < num_resp; j++){
        p01 += "&nbsp;&nbsp;&nbsp;&nbsp;_" + nombreALletra(j+1) + "_)&nbsp;" +
               resp[j] + "<br/>"
    }
    p01 += "<br/>"
}

p02 = permutacio;





// ## 2.2 FUNCIO (actualitzar) ----------------------------------------
// !!! CONVERTIR si és necessari les unitats a les unitats que requereix
// el nostre enunciat.

function estableixParametres(){
    array = [
      p01, p02, /*p03, p04, p05,          p06, p07, p08, p09, p10,
      p11, p12, p13, p14, p15,          p16, p17, p18, p19, p20,
      p21, p22, p23, p24, p25,          p26, p27, p28, p29, p30,
      p31, p32, p33
      */
    ]; // actualitzar entre []
    parametres = parametres.concat(array);  // no tocar aquesta línia
}




// # 3. CALCULS =======================================================

// ## 3.1 CALCUL VALORS (ACTUALITZAR) ---------------------------------
function calcula(){

}





// # D. ENTRENADOR SERVERI ============================================


// # 1. VARIABLES GLOBALS =============================================

let txtEnunciat = "";   // l'enunciat de l'apartat B.
let parametres = [""];  // els paràmetres del punt 3.1.
let solucions = [""];   // els valors que ha donat el programa.
let respostes = [""];   // els valors que ha donat l'alumne.
let alumne = {
    nom: "",
    cicle: "CFGM Técnic en instal·lacions elèctriques i automàtiques",
    anys: "2024/2025"
}
let tlog = "";          // log que apareix al final de l'avaluació.



// # 2. FUNCIONS ======================================================




window.onload = function (){
    // txtEnunciat és una variable global
    txtEnunciat = document.getElementById("enunciat").value;
    renderEnunciat(txtEnunciat);
}

function renderEnunciat(){
    let txt = "";
    estableixParametres(); // Va al punt 3.2. de l'apartat C. (script)
    txt = '<h1 align ="center">' + titol + "</h1>\n&nbsp;\n\n" +
          txtEnunciat;
    txt = exportarParametres(txt);
    txt = crearInputs(txt);
    txt = crearIdentificacio(txt);
    document.getElementById("enunciat").innerHTML = txt;
    document.getElementById("titol").innerText = titol;
    texme.renderPage();
}

function exportarParametres(txt){
    let patro = "", canvi = "";
    const fi = parametres.length;
    for (let i = 1; i < parametres.length; i++) {
        patro = "[[p" + i +"]]";
        canvi = l(parametres[i]);
        txt = txt.replace(patro, canvi);
    }
    return txt;
}

function crearInputs(txt){
    let patro = "", canvi = "";
    for (let i = 1; i < puntuacions.length; i++) {
        patro = "[[i" + i +"]]";
        canvi = '<input type="text" onwheel="return false;" ';
        canvi += 'id="i'+ i +'" style="width: 300px">';
        txt = txt.replace(patro, canvi);
    }
    return txt;
}

function crearIdentificacio(txt){
txt += `
<h2>Identificació de l'alumne</h2>

<form id="avalua" onsubmit="event.preventDefault() & avalua()">
    <label>Nom de l'alumne: </label>
    <input id="nom" style="width: 400px"/>
    <div>
        <input type="checkbox" id="informat" required/>
        <label>
            Entenc que al premer el botó avaluar no es pot tornar
            enrera.
        </label>
    </div>
    <br/>
    <div style="text-align: center;">
        <button type="submit" id="boto"
            style="font-size: 20px; color: #AA5050;">
            Avaluar
        </button>
    </div>
</form>
`; return txt;
}

function avalua(){
    importaRespostes();
    resetejar();
    renderAvaluacio();
}

function importaRespostes(){
    respostes[0] = document.getElementById("i1").value
    alumne.nom = document.getElementById("nom").value;
    /*let r = [""];
    alumne.nom = document.getElementById("nom").value;  // veure C.2.1
    for (let i = 1; i < puntuacions.length; i++){
        r[i] = document.getElementById("i"+i).value;
    }
    respostes = r.map(xsMap);                           // veure C.2.1
    */
}

function resetejar(){
    const ppal = document.getElementsByTagName("main")[0];
    const body = ppal.parentNode;
    const textArea = body.appendChild(document.createElement("textarea"));
    body.removeChild(ppal);
    textArea.setAttribute("id", "avaluacio");
}

function renderAvaluacio(){
    let txt = "";
    txt += '<h1 align="center"> Avaluació</h1>\n' +
           '<h2 align="center" style="color: #888">' + titol +
           "</h2>\n&nbsp;\n\n"
    txt += [
    "## Presentació de resultats",
    "",
    //"L'alumne **[[nom]]**, del [[cicle]] (any [[any]]) ha obtingut una",
    //"qualificació de:",
    "L'alumne **[[nom]]**, del [[cicle]] (any [[any]]) serà qualificat manualment.",
    "",
    //"> [[nota]]"
    ].join("\n") + "\n";
    txt += txtEnunciat;

    txt = identificarAlumne(txt);
    txt = puntua(txt);
    txt = txt.replace("## Identificació de l'alumne:\n\n"+
        "[[identificacio]]", "");
    txt +=  "\n" + tlog + "\n";
    document.getElementById("avaluacio").innerHTML = txt;
    texme.renderPage();
}

function identificarAlumne(txt){
    txt = txt.replace("[[nom]]", alumne.nom);
    txt = txt.replace("[[cicle]]", alumne.cicle);
    txt = txt.replace("[[any]]", alumne.anys);
    return txt;
}

function puntua(txt){
    calcula();

    txt = exportarParametres(txt);

    patro = "[[i1]]";
    canvi = "~~~\n    " + respostes[0] + "\n\n\n~~~";

    txt = txt.replace(patro, canvi);

    /*
    let ptsAlumne = 0, ptsTotal = 0;
    let canvi = "", patro = "";
    let a = 0, b = 0;
    for (let i = 1; i < puntuacions.length; i++){
        a = respostes[i];
        b = solucions[i];
        ptsTotal += puntuacions[i];
        canvi =
            '<span style="border-bottom: 1px solid silver; padding: 0.2em 1em 0;">'
            + coma(a) + '</span>';
        if ((b*0.99) < a && a < (b*1.01)) {
            ptsAlumne += puntuacions[i];
            canvi +=
                ' <span style="color: green">(' +
                coma(b) +') OK (+' + puntuacions[i] + ')</span>';
        }else{
            canvi +=
                ' <span style="color: red;"> (' +
                coma(b) +')</span>';
        }
        patro = "[[i" + i + "]]";

        txt = txt.replace(patro, canvi);
    }
    txt = txt.replace("[[nota]]", "S'han aconseguit: "+ xs(ptsAlumne, 2) +
        " punts de " + xs(ptsTotal, 2) + " possibles.\n>\n>" +
        "**Nota final: " + xs(ptsAlumne/ptsTotal*10, 2) + "**");
    */
    return txt;
}












function aleat(min, max) { // enter aleat entre min i max (inclosos)
    const a = Math.ceil(min);
    const b = Math.floor(max);
    const c = Math.floor(Math.random() * (b - a + 1) + a);
    return c;
}

function triaElementMatriu (matriu){
    const aleat = Math.floor(Math.random() * (matriu.length));
    return matriu[aleat.toFixed(0)];
}

function factorial(n) {
    return n <= 1 ? 1 : n * factorial(n - 1);
}

// Funció per obtenir la permutació d'un índex específic
function obtenirPermutacio(array, index) {
    let permutacio = [];
    let elements = array.slice(); // Copia de l'array per a evitar
                                  // modificar l'original
    let n = elements.length;

    // Calcular la permutació utilitzant factorials
    for (let i = 0; i < n; i++) {
        let fact = factorial(n - i - 1);
        let posicio = Math.floor(index / fact);
        permutacio.push(elements[posicio]);
        elements.splice(posicio, 1);
        index %= fact;
    }

    return permutacio;
}

function permutacions(array) {

    let resultat = [];

    // Funció recursiva per a generar les permutacions
    function generarPermutacions(actual, resta) {
        if (resta.length === 0) {
            resultat.push(actual);
        } else {
            for (let i = 0; i < resta.length; i++) {
                let actualNova = actual.concat(resta[i]);
                let restaNova = resta.slice(0, i).concat(resta.slice(i + 1));
                generarPermutacions(actualNova, restaNova);
            }
        }
    }

    generarPermutacions([], array);
    return resultat;
}


function atan(a){
    return Math.atan(a)*360/2/π;
}

function sin(a){
    return Math.sin(a*2*π/360);
}

function cos(a){
    return Math.cos(a*2*π/360);
}

function ln(a){
    return Math.log(a);
}

function cbi(x, y){ //complexe input en binomial
    const c = {};
    c.r = (x**2 + y**2)**0.5;
    c.φ = Math.atan2(y, x)*360/2/π;
    c.x = x;
    c.y = y;
    return c;
}

function cpol(r, φ){ //complexe input en polar (φ en graus)
    const c = {};
    c.r = r;
    c.φ = φ;
    c.x = r * cos(φ);
    c.y = r * sin(φ);
    return c;
}

function sumc(a, b){
    return cbi(a.x + b.x, a.y + b.y)
}

function restc(a, b){
    return cbi(a.x - b.x, a.y - b.y)
}

function multc(a, b){
    return cpol(a.r*b.r, a.φ+b.φ);
}

function multc_esc(λ, a){
    return cpol(λ*a.r, a.φ);
}

function divc(a, b){
    return cpol(a.r/b.r, a.φ-b.φ);
}

function invc(a){ // inversa d'un complexe
    return cpol(1/a.r, -a.φ);
}

function logc (nom, v){ // log de un numero complexe
    let log = "";
    log += nom + ": ";
    log += xs(v.x);
    if (v.y > 0) log += " + j" + xs(v.y);
    else if (v.y < 0) log += "-j" + xs(-v.y);
    log += "; ";
    log += xs(v.r) + "∠" + xs(v.φ) + "°\n";
    log = coma(log);
    return log;
}

function logcbi (v){ // log de un numero complexe només en binomial
    let log = "";
    log += xs(v.x);
    if (v.y > 0) log += " + j" + xs(v.y);
    else if (v.y < 0) log += "-j" + xs(-v.y);
    log = coma(log);
    return log;
}

function l(a){  // log abreviat a l totsol
    if (!a.toPrecision) return a;
    return coma(xs(a));
}

function ll(a, b = 4){ // log Latex
    return cl(xs(a, b));
}

function xs(a, b = 4){
    a = Number(a);
    if (a.toPrecision) a = a.toPrecision(b);
    return Number(a);
}

function coma(a){
    a = a + "";
    return a.replaceAll(".", ",");
}

function cl(a){ // coma per a latex
    return coma(a).replaceAll(",", "{,}");
}

function xsMap(a){
    a = xs(a);
    return a;
}


function nombreALletra(nombre) {
    const ascii = 97; // Código ASCII de 'a'
    if (nombre >= 1 && nombre <= 26) {
        // Convertir el número en el carácter correspondiente usando el código ASCII
        return String.fromCharCode(ascii + nombre - 1);
    } else {
        return null; // Retornar null si el número está fuera de rango
    }
}

</script>














<!--
/**********************************************************************
 * - Establir les puntuacions, que han de correspondre amb la quantitat
 * de respostes que l'alumne pot contestar.
 *
 * - Establir els paràmetres. En general serà una funció per a generar
 * nombres aleatoris, però també es poden fixar. Aquest últim cas és
 * interessant per a testejar els càlculs. IMPORTANT: Al finalitzar
 * tots els parametres hauran de concatenarse al vector parametres.
 *
 * -  El mateix succeeix amb els càlculs. Tot haura de volcar-se al
 * vector solucions.
 * *******************************************************************/
-->
