<!-- A. CAPÇALERA I INITS (NO TOCAR) ============================== -->
<!DOCTYPE html>
<head>
    <title id="titol"></title>
    <link rel="icon" type="image/x-icon" href=img/favicon.png>
    <meta charset="UTF-8">

    <style>
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type=number] {
      -moz-appearance: textfield;
    }

    pre{
        white-space: pre-wrap;
        overflow-wrap: break-word;
    }

    img[alt="c"]{
        display: block;
        margin-left: auto;
        margin-right: auto;
    }
    img[alt="c500"]{
        width: 500px;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }

    img[alt="c250"]{
        width: 250px;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }
    img[alt="250"]{
        width: 250px;
    }
    img[alt="fr250"]{
        width: 250px;
        float: right;
        margin: 0 0 0 0.7em;
    }
    img[alt="fr"]{
        float: right;
        margin: 0 0 0 0.7em;
    }
    img[alt="fl250"]{
        width: 250px;
        float: left;
        margin: 0 .7em 0 0;
    }
    img[alt="fl"]{
        float: left;
        margin: 0 5px 0 0;
    }
    </style>
</head>

<script>
window.texme = {
    renderOnLoad: false,
    markdownURL: 'js/marked/marked.min.js',
    MathJaxURL: 'js/mathjax/es5/tex-mml-chtml.js'
}
</script>
<script src="js/texme/texme.js"></script>

<!-- FI NO TOCAR ================================================== -->




<!-- B. ENUNCIAT ================================================== -->
<textarea id="enunciat">
~~~
&nbsp;
    Permutació: [[p2]]
&nbsp;
~~~

## Normes:
- **S'ha de gravar la pantalla durant l'examen.** Per a fer-ho podeu
  utilitzar la web [Screen capture](https://www.screencapture.com/es/),
  **recordeu a desmarcar el microfon i la webcam**
- No es poden utilitzar apunts.
- Només es pot tenir una finestra oberta (la del navegador Chrome).
- Només es pot tenir una pestanya oberta (la de l'examen).
- Està terminantment prohibit copiar o mirar al company.
- Per fer preguntes aixequeu la mà, NO US GIREU.
- La durada de l'exàmen és la que s'indiqui al moodle o classroom. O la que indiqui el professor a l'inici de la prova.
- Qualsevol incompliment serà sancionat amb un zero.
- Les preguntes correctes sumen 1 punt, les incorrectes resten 1/(numrespostes - 1) punts, les que es deixen en blanc, ni sumen ni resten.

## Com fer aquest examen:
- Agafa paper
- Comença a escriure les respostes al paper.
- Si una resposta es vol deixar en blanc escriu una n.
- Quan acabis copia les respostes sense espais i tot seguit, al camp resposta. Per exemple: abnaac
- Omple el teu nom i fes click a avaluar.
- Imprimeix la pàgina com a pdf fent «Ctrl + P»
- Adjunta-la com a tasca.
- Entrega els papers utilitzats.

## Preguntes

[[p1]]

## Resposta

[[i1]]



</textarea>
<!-- FI ENUNCIAT ================================================== -->







<!-- C. SCRIPT ==================================================== -->
<script>


// # 1. CONSTANTS (actualitzar) ---------------------------------------
const titol = "Recuperació de gràcia UT01 (MAXIM 5) - MEDASP";
const puntuacions = ["",
    10
];
const π = 3.141592654;
const RPRIMA = 287.04;                  // unitats en J/(kg*K)
const KELVIN = 273.15;                  // 0°C = 273,15 K


// # 2. PARÀMETRES ====================================================

// ## 2.1. DECLARACIÓ (actualitzar) -----------------------------------

let p01 = "";
const preguntes = [
    [
    "Per què una de les propostes inicials oposades al consumisme consistia a imitar la natura",
    "Perquè la natura no crea residus. Tot és biodegradable.",
    "Perquè la natura és la que crea els combustibles fòssils.",
    "Perquè és més senzill imitar la natura.",
    "Perquè som éssers naturals.",
    ],
    [
    "Quina d'aquestes propostes seria una manera d'implementar la regla de les 3 R a la vida diària d'un estudiant de GM?",
    "Quan al temps de l'esplai es va al supermercat a comprar alguna cosa, no demanar bossa, si això no és possible utilitzar la mateixa cada dia, i si això tampoc fos possible llençar la bossa al contenidor groc.",
    "No comprar res, si es compra que sigui el més barat possible (requereix menys recursos), si no pot ser el més barat possible almenys llençar-lo a una paperera (reduir residus).",
    "Dissenyar un mòbil més sostenible que els telèfons que hi ha actualment al mercat.",
    "Marca aquesta si no pots marcar cap de les altres respostes",
    ],
    [
    "L'economia lineal es caracteritza per...",
    "La prolongació de la vida útil dels productes.",
    "L'obtenció de guanys i cerca de l'eficiència sense considerar els costos socials i mediambientals",
    "El benestar social.",
    "La inversió en nous sistemes de producció sostenibles.",
    ],
    [
    "Quin no seria un exemple de minimalisme?",
    "Pintar les parets de blanc.",
    "Comprar una motxilla de qualitat que duri tota la secundària.",
    "Tenir una taula a casa que serveixi per dinar, estudiar, jugar a cartes, etc. en lloc d'una taula per a cada cosa.",
    "Utilitzar el transport públic.",
    ],
    [
    "Com a principal conseqüència associada als residus en l'economia lineal es pot destacar:",
    "L'acumulació de deixalles i la sobreexplotació i l'esgotament de recursos naturals.",
    "La contaminació de l'espai aeri per l'acumulació de productes defectuosos.",
    "L'aparició de tendències com el minimalisme o les compres compulsives.",
    "La creació de sistemes de distribució i consum més sostenibles.",
    ],
    [
    "Quina fase de l'economia lineal està relacionada estretament amb la mineria?",
    "Extreure.",
    "Produir.",
    "Consumir.",
    "Descartar.",
    ],
    [
    "A l'economia lineal es generen un seguit de residus. Quin final tenien tradicionalment (fins a finals del segle XX)?",
    "Enterrar-los, cremar-los.",
    "Reciclar-los.",
    "Reutilitzar-los.",
    "Fins a 1990 no es generaven residus, tot era biodegradable.",
    ],
    [
    "No és una de les fases de l'economia lineal",
    "Reduir.",
    "Produir.",
    "Consumir.",
    "Descartar.",
    ],
    [
    "Quina d'aquestes és una bona proposta per a un consum responsable",
    "Triar productes d'empreses que respectin el medi ambient i als treballadors.",
    "No canviar hàbits de la nostra vida quotidiana.",
    "Comprar productes d'empreses que afirmin ser «verdes», sense contrastar la informació.",
    "Comprar tants productes ecològics com es pugui, fins i tot si no els necessitem."
    ],
    [
    "Una de les mesures adoptades a Espanya per a reduir el plàstic d'un sol ús és:",
    "El cobrament per les bosses de plàstic als supermercats.",
    "La prohibició de les bosses i recipients de plàstic.",
    "Prohibir la venda de productes biodegradables.",
    "Per ara no s'han adoptat mesures orientades a la reducció de l'ús de plàstic.",
    ],
    [
    "Quina afirmació sobre la gran muralla verda a Àfrica és falsa",
    "És un projecte que va iniciar-se al segle XVII",
    "Ha posat d'acord a diversos països al sud del Sàhara",
    "Vol frenar la sequera i la desertificació",
    "Proporciona un mitjà de vida sostenible a les comunitats locals",
    ],
    [
    "Quin d'aquest serien exemples d'economia col·laborativa?",
    "Blabla Car, espais de coworking.",
    "Cultura empresarial sostenible, energies renovables.",
    "Convenis col·laboratius entre empreses per a pactar preus de mercat.",
    "Col·laborar amb un company que està malalt i encarregar-nos de fer la seva feina.",
    ],
    [
    "Què és l'obsolescència programada?",
    "Fabricar productes que de manera intencionada deixen de funcionar o disminueixen les seves prestacions passat un temps.",
    "Que els programes informàtics s'hagin de pagar cada any mitjançant una subscripció",
    "Fabricar productes de poca qualitat.",
    "Marca aquesta si no pots marcar cap de les altres respostes",
    ],
    [
    "Quan varen aparèixer els primers abocadors tal com el coneixem avui dia?",
    "Al neolític.",
    "Al renaixement.",
    "Al segle IV.",
    "Al segle XIX.",
    ],
    [
    "Quina d'aquestes creus que és una relació entra la revolució industrial i la cultura «d'un sol ús»?",
    "La revolució industrial va provocar un abaratiment i abundància de béns que feren que la gent comprés productes que ja tenia per a substituir els vells.",
    "A la revolució industrial es cremava carbó i, per tant, s'emetien molts de gasos contaminants.",
    "La revolució industrial es va desenvolupar la indústria que utilitzava materials nocius com el mercuri o l'urani.",
    "La revolució industrial va crear el concepte d'elements que només servien per a una cosa (per exemple un obre llaunes només serveis per a obrir llaunes), és a dir productes d'un sol ús",
    ],
];

let permutacio = "";
const num_preg = preguntes.length;
const num_resp = preguntes[0].length-1;
const fact_np = factorial(num_preg);
const fact_nr = factorial(num_resp);
/*let ordre_preg = Math.floor(aleat(0, fact_np - 1)/1e16)*/;
let ordre_preg = aleat(0, fact_np - 1);

console.log(ordre_preg)
permutacio += ordre_preg + "_";
//ordre_preg *= 1e16;

const preg_ordenades = obtenirPermutacio(preguntes, ordre_preg);

for (let i = 0; i < num_preg; i++){
    p01 += "**" + (i+1) + ".**&nbsp;" + preg_ordenades[i][0] + "<br/>";
    let ordre_resp = aleat (0, fact_nr - 1);
    permutacio += ordre_resp + ".";

    let resp = obtenirPermutacio(preg_ordenades[i].slice(1), ordre_resp);
    for (let j = 0; j < num_resp; j++){
        p01 += "&nbsp;&nbsp;&nbsp;&nbsp;_" + nombreALletra(j+1) + "_)&nbsp;" +
               resp[j] + "<br/>"
    }
    p01 += "<br/>"
}

p02 = permutacio;





// ## 2.2 FUNCIO (actualitzar) ----------------------------------------
// !!! CONVERTIR si és necessari les unitats a les unitats que requereix
// el nostre enunciat.

function estableixParametres(){
    array = [
      p01, p02
    ];
    parametres = parametres.concat(array);  // no tocar aquesta línia
}




// # 3. CALCULS =======================================================

// ## 3.1 CALCUL VALORS (ACTUALITZAR) ---------------------------------
function calcula(){

}





// # D. ENTRENADOR SERVERI ============================================


// # 1. VARIABLES GLOBALS =============================================

let txtEnunciat = "";   // l'enunciat de l'apartat B.
let parametres = [""];  // els paràmetres del punt 3.1.
let solucions = [""];   // els valors que ha donat el programa.
let respostes = [""];   // els valors que ha donat l'alumne.
let alumne = {
    nom: "",
    cicle: "CFGM Técnic en instal·lacions elèctriques i automàtiques",
    anys: "2024/2025"
}
let tlog = "";          // log que apareix al final de l'avaluació.



// # 2. FUNCIONS ======================================================




window.onload = function (){
    // txtEnunciat és una variable global
    txtEnunciat = document.getElementById("enunciat").value;
    renderEnunciat(txtEnunciat);
}

function renderEnunciat(){
    let txt = "";
    estableixParametres(); // Va al punt 3.2. de l'apartat C. (script)
    txt = '<h1 align ="center">' + titol + "</h1>\n&nbsp;\n\n" +
          txtEnunciat;
    txt = exportarParametres(txt);
    txt = crearInputs(txt);
    txt = crearIdentificacio(txt);
    document.getElementById("enunciat").innerHTML = txt;
    document.getElementById("titol").innerText = titol;
    texme.renderPage();
}

function exportarParametres(txt){
    let patro = "", canvi = "";
    const fi = parametres.length;
    for (let i = 1; i < parametres.length; i++) {
        patro = "[[p" + i +"]]";
        canvi = parametres[i];
        txt = txt.replace(patro, canvi);
    }
    return txt;
}

function crearInputs(txt){
    let patro = "", canvi = "";
    for (let i = 1; i < puntuacions.length; i++) {
        patro = "[[i" + i +"]]";
        canvi = '<input type="text" onwheel="return false;" ';
        canvi += 'id="i'+ i +'" style="width: 300px">';
        txt = txt.replace(patro, canvi);
    }
    return txt;
}

function crearIdentificacio(txt){
txt += `
<h2>Identificació de l'alumne</h2>

<form id="avalua" onsubmit="event.preventDefault() & avalua()">
    <label>Nom de l'alumne: </label>
    <input id="nom" style="width: 400px"/>
    <div>
        <input type="checkbox" id="informat" required/>
        <label>
            Entenc que al premer el botó avaluar no es pot tornar
            enrera.
        </label>
    </div>
    <br/>
    <div style="text-align: center;">
        <button type="submit" id="boto"
            style="font-size: 20px; color: #AA5050;">
            Avaluar
        </button>
    </div>
</form>
`; return txt;
}

function avalua(){
    importaRespostes();
    resetejar();
    renderAvaluacio();
}

function importaRespostes(){
    respostes[0] = document.getElementById("i1").value
    alumne.nom = document.getElementById("nom").value;
}

function resetejar(){
    const ppal = document.getElementsByTagName("main")[0];
    const body = ppal.parentNode;
    const textArea = body.appendChild(document.createElement("textarea"));
    body.removeChild(ppal);
    textArea.setAttribute("id", "avaluacio");
}

function renderAvaluacio(){
    let txt = "";
    txt += '<h1 align="center"> Avaluació</h1>\n' +
           '<h2 align="center" style="color: #888">' + titol +
           "</h2>\n&nbsp;\n\n"
    txt += [
    "## Presentació de resultats",
    "",
    "L'alumne **[[nom]]**, del [[cicle]] (any [[any]]) serà qualificat manualment.",
    "",
    ].join("\n") + "\n";
    txt += txtEnunciat;

    txt = identificarAlumne(txt);
    txt = puntua(txt);
    txt = txt.replace("## Identificació de l'alumne:\n\n"+
        "[[identificacio]]", "");
    txt +=  "\n" + tlog + "\n";
    document.getElementById("avaluacio").innerHTML = txt;
    texme.renderPage();
}

function identificarAlumne(txt){
    txt = txt.replace("[[nom]]", alumne.nom);
    txt = txt.replace("[[cicle]]", alumne.cicle);
    txt = txt.replace("[[any]]", alumne.anys);
    return txt;
}

function puntua(txt){
    calcula();

    txt = exportarParametres(txt);

    patro = "[[i1]]";
    canvi = "~~~\n    " + respostes[0] + "\n\n\n~~~";

    txt = txt.replace(patro, canvi);

    return txt;
}












function aleat(min, max) { // enter aleat entre min i max (inclosos)
    const a = Math.ceil(min);
    const b = Math.floor(max);
    const c = Math.floor(Math.random() * (b - a + 1) + a);
    return c;
}

function triaElementMatriu (matriu){
    const aleat = Math.floor(Math.random() * (matriu.length));
    return matriu[aleat.toFixed(0)];
}

function factorial(n) {
    return n <= 1 ? 1 : n * factorial(n - 1);
}

// Funció per obtenir la permutació d'un índex específic
function obtenirPermutacio(array, index) {
    let permutacio = [];
    let elements = array.slice(); // Copia de l'array per a evitar
                                  // modificar l'original
    let n = elements.length;

    // Calcular la permutació utilitzant factorials
    for (let i = 0; i < n; i++) {
        let fact = factorial(n - i - 1);
        let posicio = Math.floor(index / fact);
        permutacio.push(elements[posicio]);
        elements.splice(posicio, 1);
        index %= fact;
    }

    return permutacio;
}

function permutacions(array) {

    let resultat = [];

    // Funció recursiva per a generar les permutacions
    function generarPermutacions(actual, resta) {
        if (resta.length === 0) {
            resultat.push(actual);
        } else {
            for (let i = 0; i < resta.length; i++) {
                let actualNova = actual.concat(resta[i]);
                let restaNova = resta.slice(0, i).concat(resta.slice(i + 1));
                generarPermutacions(actualNova, restaNova);
            }
        }
    }

    generarPermutacions([], array);
    return resultat;
}


function nombreALletra(nombre) {
    const ascii = 97; // Código ASCII de 'a'
    if (nombre >= 1 && nombre <= 26) {
        // Convertir el número en el carácter correspondiente usando el código ASCII
        return String.fromCharCode(ascii + nombre - 1);
    } else {
        return null; // Retornar null si el número está fuera de rango
    }
}

</script>
