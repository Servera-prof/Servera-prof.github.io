<!-- A. CAPÇALERA I INITS (NO TOCAR) ============================== -->
<!DOCTYPE html>
<head>
    <title id="titol"></title>
    <link rel="icon" type="image/x-icon" href=img/favicon.png>
    <meta charset="UTF-8">

    <style>

    li.preg {
        display: flex;
        align-items: flex-start;
        gap: 0.5em;
        text-align: justify;
        text-justify: inter-word;

    }
    p, li{
        text-align: justify;
        text-justify: inter-word;
    }
    </style>
</head>

<script>
window.texme = {
    renderOnLoad: false,
    markdownURL: 'js/marked/marked.min.js',
    MathJaxURL: 'js/mathjax/es5/tex-mml-chtml.js'
}
</script>
<script src="js/texme/texme.js"></script>

<!-- FI NO TOCAR ================================================== -->




<!-- B. ENUNCIAT ================================================== -->
<textarea id="enunciat">
~~~
&nbsp;
    Permutació: [[p2]]
&nbsp;
~~~

## Ponderació

- Aquest examen pondera una tercera part, que es sumarà al de la de la
  UT06 i UT08.


## Normes:
- S'ha de **gravar la pantalla COMPLETA**, sense micròfon, webcam ni so.
  Pots utilitzar la web
  [Screen Capture](https://www.screencapture.com/es/)
- No es poden utilitzar apunts.
- Només es pot tenir una finestra oberta (la del navegador Chrome).
- Només es pot tenir una pestanya oberta (la de l'examen).
- Està terminantment prohibit copiar o mirar al company.
- No es poden fer preguntes. Part de l'avaluació és la comprensió del
  text. Si hi ha algun error es parlarà una vegada l'examen hagi
  finalitzat, i en el seu cas s'anul·larà la pregunta.
- L'examen dura el que indiqui la tasca associada i **es tanca automàticament**. ENTREGUEU-HO ABANS o serà un zero.
- Qualsevol incompliment serà sancionat amb un zero.
- Les preguntes correctes sumen 1 punt, les incorrectes resten 1/(numrespostes - 1) punts, les que es deixen en blanc, ni sumen ni resten.

## Com fer aquest examen:
- Agafa paper
- Comença a escriure les respostes al paper.
- Si una resposta es vol deixar en blanc escriu una n.
- Quan acabis copia les respostes sense espais i tot seguit, al camp «resposta», si no la saps n. Per exemple: abnaac
- Omple el teu nom i clica a avaluar.
- **Imprimeix la pàgina com a pdf fent «Ctrl + P»**
- Adjunta-la com a tasca.
- Fotografia el paper utilitzat (la fotografia és per a tu, per a poder revisar l'examen si ho necessitessis).
- Entrega els papers utilitzats.


## Preguntes

[[p1]]

## Resposta

[[i1]]



</textarea>
<!-- FI ENUNCIAT ================================================== -->







<!-- C. SCRIPT ==================================================== -->
<script>


// # 1. CONSTANTS (actualitzar) ---------------------------------------
const titol = "Examen UT06 - SRGMPE";
const puntuacions = ["", 10];


// # 2. PARÀMETRES ====================================================

// ## 2.1. DECLARACIÓ (actualitzar) -----------------------------------

let p01 = "";
const preguntes = [
    [
    "Quin factor determina l’amplada mínima dels vials i els radis de curvatura en el muntatge d’un parc eòlic? ",
    "El pes de les grues",
    "La longitud de les pales a transportar",
    "El nombre total d’aerogeneradors",
    "El tipus de formigó utilitzat",
    ],
    [
    "Per què el formigó convencional no és suficient per a moltes estructures?",
    "Perquè només és resistent a la compressió, però molt feble a la tracció",
    "Perquè s’endureix massa ràpid i dificulta el treball",
    "Perquè és massa flexible i es deforma amb facilitat",
    "Perquè absorbeix massa humitat i es desfà amb el temps",
    ],
    [
    "Per què es realitza un registre automàtic de dades en un parc eòlic?",
    "Per supervisar el rendiment i detectar fallades operatives",
    "Per controlar la distribució de càrregues elèctriques en altres parcs",
    "Per ajustar manualment la posició de la góndola cada cert temps",
    "Per reduir la quantitat de manteniments anuals necessaris",
    ],
    [
    "Quin és el propòsit del formigó de neteja?",
    "Anivellar la virola",
    "Protegir la cimentació",
    "Facilitar l'encofrat",
    "Totes les respostes són vàlides",
    ],
    [
    "Què determina l'ample mínim dels vials i els radis de curvatura?",
    "La longitud de les pales a transportar i de l'altura de la torre",
    "L'altura de la torre a transportar",
    "La góndola, especialment si té el transformador a la mateixa góndola",
    "La longitud de les pales",
    ],



    [
    "El procés d'instal·lació del transformador en un aerogenerador pot realitzar-se en l'interior de la góndola o en la/el/l' _____",
    "Torre de l'aerogenerador",
    "Base de la torre",
    "Subestació elèctrica",
    "Exterior de la góndola",
    ],
    [
    "Quina màquina és essencial per a l’hissat de les torres d’aerogeneradors? ",
    "Retroexcavadora",
    "Grues mòbils amb aparell d’elevació tipus ploma",
    "Compactadora de sòl",
    "Camió formigonera",
    ],
    [
    "Quina tasca no forma part del procés d’execució de les cimentacions? ",
    "Replanteig, desbrossat i excavació",
    "Col·locació del primer tram de torre a sobre de la virola de la cimentació",
    "Formigonat de la cimentació",
    "Col·locació de tubs de cablejat de mitja tensió",
    ],
    [
    "Quina és una de les funcions principals de la cel·la de protecció en el sistema elèctric d’un aerogenerador? ",
    "Proporcionar protecció contra sobreintensitats i curtcircuits",
    "Proporcionar protecció contra sobreintensitats, curtcircuits i sobretensions",
    "Protegir contra velocitats anormalment elevades (que generin electricitat a freqüències diferents de 50 Hz)",
    "Evitar que es cremi el rotor de l'aerogenerador per sobrecàrregues en pics de producció",
    ],
    [
    "Quin fus pel sistema de coordenades UTM tenen les illes Balears? ",
    "31",
    "31416",
    "2817182",
    "7",
    ],
    [
    'Anomena el que estan trepitjant els operaris en la imatge<br/><br/><img width="500px" src="img/exam_UT06_01.jpg">',
    "Armadura del pedestal de la virola",
    "Encofrat de la fonamentació de l'aerogenerador",
    "Enferrat de sustentació i anivellament",
    "Plataforma de neteja",
    ],
    [
    'Per a què serveixen aquests petits cilindres que es veuen en les 4 últimes imatges<br/><br/><img width="500px" src="img/exam_UT06_02.jpg">',
    "Són testimonis (<i>testigos</i> en castellà), en cas d'accident, els enginyers poden recórrer a ells per a comprovar si és un problema que té a veure amb el formigó. S'han de guardar 25 anys (la vida útil del parc)",
    "Són assajos, s'aboca formigó i s'espera que sequi, si és satisfactori s'utilitza el formigó del camió, en cas contrari no.",
    "Són provetes per a fer assajos al laboratori per certificar la qualitat del formigó.",
    "Són petits suports de formigó, es fabriquen mitjançant motlles i s'utilitzen els cilindres per a muntatges complexos.",
    ],
];

let permutacio = "";
const num_preg = preguntes.length;
const num_resp = preguntes[0].length-1;
const fact_np = factorial(num_preg);
const fact_nr = factorial(num_resp);
/*let ordre_preg = Math.floor(aleat(0, fact_np - 1)/1e16)*/;
let ordre_preg = aleat(0, fact_np - 1);

console.log(ordre_preg)
permutacio += ordre_preg + "_";
//ordre_preg *= 1e16;

const preg_ordenades = obtenirPermutacio(preguntes, ordre_preg);

for (let i = 0; i < num_preg; i++){
    p01 += '<p><b>' + (i+1) + '.</b> ' + preg_ordenades[i][0] + '</p>';
    let ordre_resp = aleat (0, fact_nr - 1);
    permutacio += ordre_resp + ".";

    let resp = obtenirPermutacio(preg_ordenades[i].slice(1), ordre_resp);
    p01 += '<ol style="list-style-type: none;">'
    for (let j = 0; j < num_resp; j++){
        p01 += '<li class="preg"><span><i>' + nombreALletra(j+1) +
               '</i>) </span><span style="flex: 1;">' +
               resp[j] + "</span></li>"
    }
    p01 += "</ol>"
}

p02 = permutacio;





// ## 2.2 FUNCIO (actualitzar) ----------------------------------------
// !!! CONVERTIR si és necessari les unitats a les unitats que requereix
// el nostre enunciat.

function estableixParametres(){
    array = [
      p01, p02
    ];
    parametres = parametres.concat(array);  // no tocar aquesta línia
}




// # 3. CALCULS =======================================================

// ## 3.1 CALCUL VALORS (ACTUALITZAR) ---------------------------------
function calcula(){

}





// # D. ENTRENADOR SERVERI ============================================


// # 1. VARIABLES GLOBALS =============================================

let txtEnunciat = "";   // l'enunciat de l'apartat B.
let parametres = [""];  // els paràmetres del punt 3.1.
let solucions = [""];   // els valors que ha donat el programa.
let respostes = [""];   // els valors que ha donat l'alumne.
let alumne = {
    nom: "",
    cicle: "CFGS Técnic Superior en Energies Renovables",
    anys: "2024/2025"
}
let tlog = "";          // log que apareix al final de l'avaluació.



// # 2. FUNCIONS ======================================================




window.onload = function (){
    // txtEnunciat és una variable global
    txtEnunciat = document.getElementById("enunciat").value;
    renderEnunciat(txtEnunciat);
}

function renderEnunciat(){
    let txt = "";
    estableixParametres(); // Va al punt 3.2. de l'apartat C. (script)
    txt = '<h1 align ="center">' + titol + "</h1>\n&nbsp;\n\n" +
          txtEnunciat;
    txt = exportarParametres(txt);
    txt = crearInputs(txt);
    txt = crearIdentificacio(txt);
    document.getElementById("enunciat").innerHTML = txt;
    document.getElementById("titol").innerText = titol;
    texme.renderPage();
}

function exportarParametres(txt){
    let patro = "", canvi = "";
    const fi = parametres.length;
    for (let i = 1; i < parametres.length; i++) {
        patro = "[[p" + i +"]]";
        canvi = parametres[i];
        txt = txt.replace(patro, canvi);
    }
    return txt;
}

function crearInputs(txt){
    let patro = "", canvi = "";
    for (let i = 1; i < puntuacions.length; i++) {
        patro = "[[i" + i +"]]";
        canvi = '<input type="text" onwheel="return false;" ';
        canvi += 'id="i'+ i +'" style="width: 300px">';
        txt = txt.replace(patro, canvi);
    }
    return txt;
}

function crearIdentificacio(txt){
txt += `
<h2>Identificació de l'alumne</h2>

<form id="avalua" onsubmit="event.preventDefault() & avalua()">
    <label>Nom de l'alumne: </label>
    <input id="nom" style="width: 400px"/>
    <div>
        <input type="checkbox" id="informat" required/>
        <label>
            Entenc que al premer el botó avaluar no es pot tornar
            enrera.
        </label>
    </div>
    <br/>
    <div style="text-align: center;">
        <button type="submit" id="boto"
            style="font-size: 20px; color: #AA5050;">
            Avaluar
        </button>
    </div>
</form>
`; return txt;
}

function avalua(){
    importaRespostes();
    resetejar();
    renderAvaluacio();
}

function importaRespostes(){
    respostes[0] = document.getElementById("i1").value
    alumne.nom = document.getElementById("nom").value;
}

function resetejar(){
    const ppal = document.getElementsByTagName("main")[0];
    const body = ppal.parentNode;
    const textArea = body.appendChild(document.createElement("textarea"));
    body.removeChild(ppal);
    textArea.setAttribute("id", "avaluacio");
}

function renderAvaluacio(){
    let txt = "";
    txt += '<h1 align="center"> Avaluació</h1>\n' +
           '<h2 align="center" style="color: #888">' + titol +
           "</h2>\n&nbsp;\n\n"
    txt += [
    "## Presentació de resultats",
    "",
    "L'alumne **[[nom]]**, del [[cicle]] (any [[any]]) serà qualificat manualment.",
    "",
    ].join("\n") + "\n";
    txt += txtEnunciat;

    txt = identificarAlumne(txt);
    txt = puntua(txt);
    txt = txt.replace("## Identificació de l'alumne:\n\n"+
        "[[identificacio]]", "");
    txt +=  "\n" + tlog + "\n";
    document.getElementById("avaluacio").innerHTML = txt;
    texme.renderPage();
}

function identificarAlumne(txt){
    txt = txt.replace("[[nom]]", alumne.nom);
    txt = txt.replace("[[cicle]]", alumne.cicle);
    txt = txt.replace("[[any]]", alumne.anys);
    return txt;
}

function puntua(txt){
    calcula();

    txt = exportarParametres(txt);

    patro = "[[i1]]";
    canvi = "~~~\n    " + respostes[0] + "\n\n\n~~~";

    txt = txt.replace(patro, canvi);

    return txt;
}












function aleat(min, max) { // enter aleat entre min i max (inclosos)
    const a = Math.ceil(min);
    const b = Math.floor(max);
    const c = Math.floor(Math.random() * (b - a + 1) + a);
    return c;
}

function triaElementMatriu (matriu){
    const aleat = Math.floor(Math.random() * (matriu.length));
    return matriu[aleat.toFixed(0)];
}

function factorial(n) {
    return n <= 1 ? 1 : n * factorial(n - 1);
}

// Funció per obtenir la permutació d'un índex específic
function obtenirPermutacio(array, index) {
    let permutacio = [];
    let elements = array.slice(); // Copia de l'array per a evitar
                                  // modificar l'original
    let n = elements.length;

    // Calcular la permutació utilitzant factorials
    for (let i = 0; i < n; i++) {
        let fact = factorial(n - i - 1);
        let posicio = Math.floor(index / fact);
        permutacio.push(elements[posicio]);
        elements.splice(posicio, 1);
        index %= fact;
    }

    return permutacio;
}

function permutacions(array) {

    let resultat = [];

    // Funció recursiva per a generar les permutacions
    function generarPermutacions(actual, resta) {
        if (resta.length === 0) {
            resultat.push(actual);
        } else {
            for (let i = 0; i < resta.length; i++) {
                let actualNova = actual.concat(resta[i]);
                let restaNova = resta.slice(0, i).concat(resta.slice(i + 1));
                generarPermutacions(actualNova, restaNova);
            }
        }
    }

    generarPermutacions([], array);
    return resultat;
}


function nombreALletra(nombre) {
    const ascii = 97; // Código ASCII de 'a'
    if (nombre >= 1 && nombre <= 26) {
        // Convertir el número en el carácter correspondiente usando el código ASCII
        return String.fromCharCode(ascii + nombre - 1);
    } else {
        return null; // Retornar null si el número está fuera de rango
    }
}

</script>
