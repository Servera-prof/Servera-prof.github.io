<!-- MOLT IMPORTANT: Al final del document es poden trobar les
instruccions sobre la utilització d'aquesta eina.-->


<!-- A. CAPÇALERA I INITS (NO TOCAR) ============================== -->
<!DOCTYPE html>
<head>
    <title id="titol"></title>
    <link rel="icon" type="image/x-icon" href=img/favicon.png>
    <meta charset="UTF-8">
</head>

<script>
window.texme = {
    renderOnLoad: false,
    markdownURL: 'js/marked/marked.min.js',
    MathJaxURL: 'js/mathjax/es5/tex-mml-chtml.js'
}
</script>
<script src="js/texme/texme.js"></script>

<!-- FI NO TOCAR ================================================== -->




<!-- B. ENUNCIAT ================================================== -->
<textarea id="enunciat">

## Enunciat

Es té un aerogenerador de 3 pales, amb una longitud de l'aspa de
[[p1]] m que gira a [[p2]] rpm, mentre està sotmesa a un vent de
[[p3]] km/h.

- En general, a quina altura s'hauria de situar la boixa?<br/>
 [[i1]] m.
- Quina seria la velocitat lineal que es veuria al punt mitjà de la
 pala?<br/>
 [[i2]] km/h
- El flux d'aire que travessarà la pala, a la meitat del seu radi,
 a quina velocitat anirà?<br/>
 [[i3]] km/h
- Quin serà l'angle d'atac, si l'angle de pas en aquest punt és de
 [[p4]] °<br/>
 [[i4]] °


Per a aquest perfil aerodinàmic, i aquest angle d'atac, el coeficient de
sustentació és de [[p5]] i el coeficient d'arrossegament és de [[p6]].
Es demana calcular:

- L'eficiència de la pala: [[i5]]
- La força de sustentació: [[i6]] kN
- La força de fregament amb l'aire: [[i7]] kN


Conegudes les forces anteriors, i suposant que l'angle constructiu és
constant es demana deduir:

- La força motriu: [[i8]] kN
- La força axial: [[i9]] kN


Després del pas per l'aerogenerador la velocitat és de [[p7]] m/s, i
els assajos han demostrat que el rendiment mecànic i elèctric són del
[[p8]] % i [[p9]] % i que el coeficient de potència és del [[p10]] %.
Amb aquestes dades es demana calcular:

- La potència aprofitada del vent: [[i10]] kW
- La potència mecànica: [[i11]] kW
- La potència elèctrica: [[i12]] kW


&nbsp;

## Formulari

**Altura de la boixa**

$$
\begin{gather}
h = 0{,}75 \cdot D + 10
\end{gather}
$$

A on:

- $h$ és l'altura de la boixa en $\text{m}$
- $D$ és el diàmetre de les pales en $\text{m}$


&nbsp;

**Velocitat d'arrosegament**

$$
\begin{gather}
v_t = \Omega \cdot r \\[5 mm]
\overrightarrow{v} = \overrightarrow{v_1} + \overrightarrow{v_t}
 \\[5 mm]
v = \sqrt{v_1^2 + v_t^2} = \sqrt{v_1^2 + (\Omega \cdot r)^2} \\[5 mm]
\delta = \alpha + \beta
\end{gather}
$$

A on:

- $\overrightarrow{v}$ és la velocitat total del flux d'aire en
 $\text{m/s}$
- $\overrightarrow{v_1}$ és la velocitat d'entrada en $\text{m/s}$
- $\overrightarrow{v_t}$ és la velocitat tangencial en $\text{m/s}$
- $\Omega$ és la velocitat angular del rotor en $\text{rad/s}$
- $r$ es la distància d'un punt a la boixa en $\text{m}$
- $\alpha$ és l'angle d'atac
- $\beta$ és l'angle de pas
- $\delta$ és l'angle constructiu

&nbsp;

**Forces**

$$
\begin{gather}
F_s = \dfrac {1}{2} \cdot \left( C_a \cdot \rho \cdot A \cdot v^2
 \right) \\[5 mm]
F_r = \dfrac {1}{2} \cdot \left( C_b \cdot \rho \cdot A \cdot v^2
 \right) \\[5 mm]
E = \dfrac {C_a}{C_b} \\[5 mm]
F_m = F_s \cdot \sin \delta - F_r \cdot \cos \delta \\[5 mm]
F_a = F_s \cdot \cos \delta + F_r \cdot \sin \delta
\end{gather}
$$

A on:

- $F_s$ és la força de sustentació en $\text{N}$
- $F_r$ és la força de resistència en $\text{N}$
- $C_a$ és el coeficient de sustentació
- $C_b$ és el coeficient d'arrossegament
- $\rho$ és la densitat de l'aire en $kg/m^3$
- $A$ és l'àrea de l'aerogenerador en $m^2$
- $v$ és la velocitat en $m/s$
- $E$ és l'eficiència
- $F_m$ és la força de motriu en $\text{N}$
- $F_a$ és la força axial en $\text{N}$
- $\delta$ és l'angle constructiu


**Potència**

$$
\begin{gather}
P=\dfrac{1}{2} \cdot \rho \cdot A \cdot v^3 \cdot C_p \\[5 mm]
P=\dfrac{1}{2} \cdot \rho \cdot A \cdot v^3 \cdot C_p \cdot \eta_m
 \\[5 mm]
P=\dfrac{1}{2} \cdot \rho \cdot A \cdot v^3 \cdot C_p \cdot \eta_m
\eta_e
\end{gather}
$$

A on:

- $P$ és la potència en $\text{W}$
- $\rho$ és la densitat de l'aire en $\text{kg/m}^3$
- $A$ és l'àrea de l'aerogenerador en $m^2$
- $v$ és la velocitat en $\text{m/s}$
- $C_p$ és el coeficient de potència o d'aprofitament
- $\eta_m$ i $eta_e$ són els rendiments mecànic i elèctric
respectivament

&nbsp;

</textarea>
<!-- FI ENUNCIAT ================================================== -->







<!-- C. SCRIPT ==================================================== -->
<script>


// # 1. CONSTANTS (actualitzar) ---------------------------------------
const titol = "UT01c - Exercici 01";
const puntuacions = ["",
    1, 1, 1, 1, 1,
    1, 1, 1, 1, 1,
    1, 1
];
const ρ = 1.225;
const π = 3.141592654;


// # 2. PARÀMETRES ====================================================

// ## 2.1. DECLARACIÓ (actualitzar) -----------------------------------
// !!! SEMPRE amb els valors en les unitats de les fórmules, o S.I.

const r_pala = aleat(15, 30);
const r = r_pala/2;

const Ω_rpm = aleat(20, 30);
const Ω = Ω_rpm/60*2*π;

const v1_kmph = aleat (20, 40);
const v1 = v1_kmph/3.6;

const β = aleat(5, 15);

const ca = xs(aleat(1, 13)/10, 2);
const cb = xs(ca/aleat(3, 30), 1);

const v2 = xs(v1/(aleat(15, 30)/10), 2);

const ηm = aleat (90, 95);
const ηe = aleat (90, 95);

const cp = aleat (35, 50);


// ## 2.2 FUNCIO (actualitzar) ----------------------------------------
// !!! CONVERTIR si és necessari les unitats a les unitats que requereix
// el nostre enunciat.

function estableixParametres(){
    p = [
        r_pala,  Ω_rpm, v1_kmph,  β, ca,
        cb, v2,    ηm,       ηe,  cp,
    ];                                  // actualitzar entre []
    parametres = parametres.concat(p);  // no tocar aquesta línia
}


// # 3. CALCULS =======================================================

// ## 3.1 CALCUL VALORS (ACTUALITZAR) ---------------------------------
function calcula(){

    h = 0.75*(r_pala * 2) + 10;
    vt = Ω*r;
    v = cbi(v1, -vt);
    δ = 90 + v.φ;
    α = δ - β;
    e = ca/cb;
    a = π * r_pala**2;
    fs = cpol(0.5 * ca * ρ * a * v.r**2, δ);
    fr = cpol(0.5 * cb * ρ * a * v.r**2, δ - 90);
    f = sumc (fs, fr);
    fm = f.y;
    fa = f.x;
    p = 0.5 * ρ * a * v1**3 * cp/100;
    pm = p * ηm/100;
    pe = pm * ηe/100;

    solucions = [""].concat([
        h,        vt*3.6,   v.r*3.6, α,      e,
        fs.r/1e3, fr.r/1e3, fm/1e3,  fa/1e3, p/1e3,
        pm/1e3,       pe/1e3,
    ].map(xsMap));


// ## 3.2 LOG ---------------------------------------------------------
tlog +=
`
~~~

r_pala = ${l(r_pala)}
r = r_pala/2 = ${l(r)}
Ω = ${Ω_rpm} rpm = ${l(Ω)} rad/s
v1 = ${v1_kmph} km/h = ${l(v1)} m/s
β = ${l(β)} °
Ca = ${l(ca)} %
Cb = ${l(cb)} %
v2 = ${l(v2)} m/s
ηm = ${l(ηm)} %
ηe = ${l(ηe)} %
Cp = ${l(cp)}


h = ${l(h)};
vt = ${l(vt)}
v = ${l(v.r)}
δ = ${l(δ)} °
α = ${l(α)} °

E = ${l(e)}
A = ${l(a)}

Fs = ${l(fs.r/1e3)} kN
Fr = ${l(fr.r/1e3)} kN
F = ${l(f.r/1e3)} kN
Fm = ${l(fm/1e3)} kN
Fa = ${l(fa/1e3)} kN

P = ${l(p/1e3)} kW
Pm = ${l(pm/1e3)} kW
Pe = ${l(pe/1e3)} kW
~~~
`
}





// # D. ENTRENADOR SERVERI ============================================


// # 1. VARIABLES GLOBALS =============================================

let txtEnunciat = "";   // l'enunciat de l'apartat B.
let parametres = [""];  // els paràmetres del punt 3.1.
let solucions = [""];   // els valors que ha donat el programa.
let respostes = [""];   // els valors que ha donat l'alumne.
let alumne = {
    nom: "",
    cicle: "CFGS Técnic Superior en Energies Renovables",
    anys: "2024/2025"
}
let tlog = "";          // log que apareix al final de l'avaluació.



// # 2. FUNCIONS ======================================================

window.onload = function (){
    // txtEnunciat és una variable global
    txtEnunciat = document.getElementById("enunciat").value;
    renderEnunciat(txtEnunciat);
}

function renderEnunciat(){
    let txt = "";
    estableixParametres(); // Va al punt 3.2. de l'apartat C. (script)
    txt = '<h1 align ="center">' + titol + "</h1>\n&nbsp;\n\n" +
          txtEnunciat;
    txt = exportarParametres(txt);
    txt = crearInputs(txt);
    txt = crearIdentificacio(txt);
    document.getElementById("enunciat").innerHTML = txt;
    document.getElementById("titol").innerText = titol;
    texme.renderPage();
}

function exportarParametres(txt){
    let patro = "", canvi = "";
    const fi = parametres.length;
    for (let i = 1; i < parametres.length; i++) {
        patro = "[[p" + i +"]]";
        canvi = l(parametres[i]);
        txt = txt.replace(patro, canvi);
    }
    return txt;
}

function crearInputs(txt){
    let patro = "", canvi = "";
    for (let i = 1; i < puntuacions.length; i++) {
        patro = "[[i" + i +"]]";
        canvi = '<input type="number" onwheel="return false;" ';
        canvi += 'id="i'+ i +'" style="width: 80px">';
        txt = txt.replace(patro, canvi);
    }
    return txt;
}

function crearIdentificacio(txt){
txt += `
<h2>Identificació de l'alumne</h2>

<form id="avalua" onsubmit="event.preventDefault() & avalua()">
    <label>Nom de l'alumne: </label>
    <input id="nom" style="width: 400px"/>
    <div>
        <input type="checkbox" id="informat" required/>
        <label>
            Entenc que al premer el botó avaluar no es pot tornar
            enrera.
        </label>
    </div>
    <br/>
    <div style="text-align: center;">
        <button type="submit" id="boto"
            style="font-size: 20px; color: #AA5050;">
            Avaluar
        </button>
    </div>
</form>
`; return txt;
}

function avalua(){
    importaRespostes();
    resetejar();
    renderAvaluacio();
}

function importaRespostes(){
    let r = [""];
    alumne.nom = document.getElementById("nom").value;  // veure C.2.1
    for (let i = 1; i < puntuacions.length; i++){
        r[i] = document.getElementById("i"+i).value;
    }
    respostes = r.map(xsMap);                           // veure C.2.1
}

function resetejar(){
    const ppal = document.getElementsByTagName("main")[0];
    const body = ppal.parentNode;
    const textArea = body.appendChild(document.createElement("textarea"));
    body.removeChild(ppal);
    textArea.setAttribute("id", "avaluacio");
}

function renderAvaluacio(){
    let txt = "";
    txt += '<h1 align="center"> Avaluació</h1>\n' +
           '<h2 align="center" style="color: #888">' + titol + "</h2>\n&nbsp;\n\n"
    txt += [
    "## Presentació de resultats",
    "",
    "L'alumne **[[nom]]**, del [[cicle]] (any [[any]]) ha obtingut una",
    "qualificació de:",
    "",
    "> [[nota]]"
    ].join("\n") + "\n";
    txt += "## Enunciat\n\n" + txtEnunciat;

    txt = identificarAlumne(txt);
    txt = puntua(txt);
    txt = txt.replace("## Identificació de l'alumne:\n\n"+
        "[[identificacio]]", "");
    txt +=  "\n" + tlog + "\n";
    document.getElementById("avaluacio").innerHTML = txt;
    texme.renderPage();
}

function identificarAlumne(txt){
    txt = txt.replace("[[nom]]", alumne.nom);
    txt = txt.replace("[[cicle]]", alumne.cicle);
    txt = txt.replace("[[any]]", alumne.anys);
    return txt;
}

function puntua(txt){
    calcula();

    txt = exportarParametres(txt);

    let ptsAlumne = 0, ptsTotal = 0;
    let canvi = "", patro = "";
    let a = 0, b = 0;
    for (let i = 1; i < puntuacions.length; i++){
        a = respostes[i];
        b = solucions[i];
        ptsTotal += puntuacions[i];
        canvi =
            '<span style="border-bottom: 1px solid silver; padding: 0.2em 1em 0;">'
            + coma(a) + '</span>';
        if ((b*0.99) < a && a < (b*1.01)) {
            ptsAlumne += puntuacions[i];
            canvi +=
                ' <span style="color: green">(' +
                coma(b) +') OK (+' + puntuacions[i] + ')</span>';
        }else{
            canvi +=
                ' <span style="color: red;"> (' +
                coma(b) +')</span>';
        }
        patro = "[[i" + i + "]]";

        txt = txt.replace(patro, canvi);
    }
    txt = txt.replace("[[nota]]", "S'han aconseguit: "+ xs(ptsAlumne, 2) +
        " punts de " + xs(ptsTotal, 2) + " possibles.\n>\n>" +
        "**Nota final: " + xs(ptsAlumne/ptsTotal*10, 2) + "**");
    return txt;
}












function aleat(min, max) { // enter aleat entre min i max (inclosos)
    const a = Math.ceil(min);
    const b = Math.floor(max);
    const c = Math.floor(Math.random() * (b - a + 1) + a);
    return c;
}

function triaElementMatriu (matriu){
    const aleat = Math.floor(Math.random() * (matriu.length));
    return matriu[aleat.toFixed(0)];
}

function atan(a){
    return Math.atan(a)*360/2/π;
}

function sin(a){
    return Math.sin(a*2*π/360);
}

function cos(a){
    return Math.cos(a*2*π/360);
}

function cbi(x, y){ //complexe input en binomial
    const c = {};
    c.r = (x**2 + y**2)**0.5;
    c.φ = Math.atan2(y, x)*360/2/π;
    c.x = x;
    c.y = y;
    return c;
}

function cpol(r, φ){ //complexe input en polar (φ en graus)
    const c = {};
    c.r = r;
    c.φ = φ;
    c.x = r * cos(φ);
    c.y = r * sin(φ);
    return c;
}

function sumc(a, b){
    return cbi(a.x + b.x, a.y + b.y)
}

function restc(a, b){
    return cbi(a.x - b.x, a.y - b.y)
}

function multc(a, b){
    return cpol(a.r*b.r, a.φ+b.φ);
}

function multc_esc(λ, a){
    return cpol(λ*a.r, a.φ);
}

function divc(a, b){
    return cpol(a.r/b.r, a.φ-b.φ);
}

function invc(a){ // inversa d'un complexe
    return cpol(1/a.r, -a.φ);
}

function logc (nom, v){ // log de un numero complexe
    let log = "";
    log += nom + ": ";
    log += xs(v.x);
    if (v.y > 0) log += " + j" + xs(v.y);
    else if (v.y < 0) log += "-j" + xs(-v.y);
    log += "; ";
    log += xs(v.r) + "∠" + xs(v.φ) + "°\n";
    log = coma(log);
    return log;
}

function logcbi (v){ // log de un numero complexe només en binomial
    let log = "";
    log += xs(v.x);
    if (v.y > 0) log += " + j" + xs(v.y);
    else if (v.y < 0) log += "-j" + xs(-v.y);
    log = coma(log);
    return log;
}

function l(a){  // log abreviat a l totsol
    if (!a.toPrecision) return a;
    return coma(xs(a));
}

function ll(a, b = 4){ // log Latex
    return cl(xs(a, b));
}

function xs(a, b = 4){
    a = Number(a);
    if (a.toPrecision) a = a.toPrecision(b);
    return Number(a);
}

function coma(a){
    a = a + "";
    return a.replaceAll(".", ",");
}

function cl(a){ // coma per a latex
    return coma(a).replaceAll(",", "{,}");
}

function xsMap(a){
    a = xs(a);
    return a;
}

</script>














<!--
/**********************************************************************
 * - Establir les puntuacions, que han de correspondre amb la quantitat
 * de respostes que l'alumne pot contestar.
 *
 * - Establir els paràmetres. En general serà una funció per a generar
 * nombres aleatoris, però també es poden fixar. Aquest últim cas és
 * interessant per a testejar els càlculs. IMPORTANT: Al finalitzar
 * tots els parametres hauran de concatenarse al vector parametres.
 *
 * -  El mateix succeeix amb els càlculs. Tot haura de volcar-se al
 * vector solucions.
 * *******************************************************************/
-->
