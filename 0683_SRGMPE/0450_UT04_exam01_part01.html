<!-- A. CAPÇALERA I INITS (NO TOCAR) ============================== -->
<!DOCTYPE html>
<head>
    <title id="titol"></title>
    <link rel="icon" type="image/x-icon" href=img/favicon.png>
    <meta charset="UTF-8">

    <style>

    li.preg {
        display: flex;
        align-items: flex-start;
        gap: 0.5em;
        text-align: justify;
        text-justify: inter-word;

    }
    p, li{
        text-align: justify;
        text-justify: inter-word;
    }
    </style>
</head>

<script>
window.texme = {
    renderOnLoad: false,
    markdownURL: 'js/marked/marked.min.js',
    MathJaxURL: 'js/mathjax/es5/tex-mml-chtml.js'
}
</script>
<script src="js/texme/texme.js"></script>

<!-- FI NO TOCAR ================================================== -->




<!-- B. ENUNCIAT ================================================== -->
<textarea id="enunciat">
~~~
&nbsp;
    Permutació: [[p2]]
&nbsp;
~~~

## Ponderació

- Aquest examen pondera un 30 %, que s'afegirà a la nota de la UT03 que
  també ponderarà un 30 %. Finalment la prova de la rosa dels vents
  ponderarà un 40 %.
- El test de la UT05 ponderarà un 30 %, l'altre 70 % correspondrà a la
  prova pràctica.


## Normes:
- S'ha de **gravar la pantalla COMPLETA**, sense micròfon, webcam ni so.
  Pots utilitzar la web
  [Screen Capture](https://www.screencapture.com/es/)
- No es poden utilitzar apunts.
- Només es pot tenir una finestra oberta (la del navegador Chrome).
- Només es pot tenir una pestanya oberta (la de l'examen).
- Està terminantment prohibit copiar o mirar al company.
- No es poden fer preguntes. Part de l'avaluació és la comprensió del
  text. Si hi ha algun error es parlarà una vegada l'examen hagi
  finalitzat, i en el seu cas s'anul·larà la pregunta.
- L'examen dura el que indiqui la tasca associada i **es tanca automàticament**. ENTREGUEU-HO ABANS o serà un zero.
- Qualsevol incompliment serà sancionat amb un zero.
- Les preguntes correctes sumen 1 punt, les incorrectes resten 1/(numrespostes - 1) punts, les que es deixen en blanc, ni sumen ni resten.

## Com fer aquest examen:
- Agafa paper
- Comença a escriure les respostes al paper.
- Si una resposta es vol deixar en blanc escriu una n.
- Quan acabis copia les respostes sense espais i tot seguit, al camp «resposta», si no la saps n. Per exemple: abnaac
- Omple el teu nom i clica a avaluar.
- **Imprimeix la pàgina com a pdf fent «Ctrl + P»**
- Adjunta-la com a tasca.
- Fotografia el paper utilitzat (la fotografia és per a tu, per a poder revisar l'examen si ho necessitessis).
- Entrega els papers utilitzats.


## Preguntes

[[p1]]

## Resposta

[[i1]]



</textarea>
<!-- FI ENUNCIAT ================================================== -->







<!-- C. SCRIPT ==================================================== -->
<script>


// # 1. CONSTANTS (actualitzar) ---------------------------------------
const titol = "Examen UT04 (test) - SRGMPE";
const puntuacions = ["", 10];


// # 2. PARÀMETRES ====================================================

// ## 2.1. DECLARACIÓ (actualitzar) -----------------------------------

let p01 = "";
const preguntes = [
    [
    "Quin és l'objectiu principal de l'estàndard internacional IEC 61400-25 per a parcs eòlics? ",
    "Establir un sistema de comunicació estandarditzada per al control i supervisió dins d’un parc eòlic. ",
    "Millorar l’eficiència de les màquines dels aerogeneradors. ",
    "Desenvolupar un sistema de control d’emissions de CO<sub>2</sub> en parcs eòlics. ",
    "Crear un sistema de comunicació exclusiva per a cada aerogenerador. ",
    ],
    [
    "Quin element <b>no</b> forma part del pla de qualitat en el muntatge? ",
    "Manual de procediments específics.",
    "Manual de gestió financera.",
    "Manual de qualitat.",
    "Manual de procediments generals.",
    ],
    [
    "Qui elabora cada document ",
    "ESS → el projectista, PSS → la contracta, NTP → INSHT",
    "ESS → la contracta, PSS → el projectista, NTP → INSHT",
    "ESS → INSHT, PSS → la contracta, NTP → el projectista",
    "ESS → INSHT, PSS → el projectista, NTP → la contracta",
    ],
    [
    "Per què és important comptar amb acords o contractes marc amb proveïdors?",
    "Per eliminar la necessitat de realitzar comandes personalitzades per cada reparació.",
    "Per agilitzar el subministrament de components i materials amb garanties preestablertes.",
    "Per centralitzar totes les comandes en un únic proveïdor, independentment del tipus de material.",
    "Per evitar la necessitat de fer registres d’entrada i sortida al magatzem.",
    ],
    [
    "Què s'ha de fer amb consumibles susceptibles de degradació?",
    "Utilitzar embalatges de plàstic, mai de vidre o cartró.",
    "Evitar condicions climàtiques adverses.",
    "Controlar les seves dates de caducitat.",
    "Hi ha més d'una resposta correcta",
    ],




    [
    "Quina és la principal diferència entre un magatzem caòtic i un magatzem ordenat? ",
    "Un magatzem caòtic no utilitza cap sistema de gestió, mentre que un magatzem ordenat sí. ",
    "En un magatzem caòtic, els productes es col·loquen en ubicacions aleatòries, però gestionades per un sistema, mentre que en un magatzem ordenat, les ubicacions estan prefixades i classificades. ",
    "Un magatzem caòtic és més petit, mentre que un magatzem ordenat requereix grans espais. ",
    "Els magatzems caòtics només emmagatzemen productes de baixa rotació, mentre que els ordenats emmagatzemen productes de rotació alta. ",
    ],
    [
    "Totes les respostes següents són diferents informacions que ha de recollir el programa d'aprovisionament, excepte una. S'ha de marcar la resposta discordant.",
    "Llista d'activitats",
    "Xarxa de precedències múltiples",
    "Inversions parcials previstes (en percentatge)",
    "Estudi de rendibilitat econòmica d'acord amb la previsió de producció energètica",
    ],
    [
    "Dels tipus de magatzems estudiats...",
    "el magatzem general es troba a prop de la subestació, el magatzem d'equips té caràcter temporal, i al magatzem d'obra s'hi poden trobar barracons destinats a emmagatzemar eines i pertinences.",
    "el magatzem general es troba a prop de la subestació, el magatzem d'equips té caràcter permanent, i al magatzem d'obra és on trobarem les oficines",
    "el magatzem general té caràcter temporal, el magatzem d'equips té caràcter permanent, i el magatzem d'obra és on habitualment mengen els treballadors",
    "en general, els magatzems dels parcs eòlics solen estar centralitzats en un únic magatzem fet de barracons d'obra desmuntables",
    ],
    [
    "A on s'emmagatzemen els recanvis una vegada el parc comença a funcionar i qui elaborarà la llista de recanvis?",
    "Els recanvis es troben al magatzem temporal i la llista l'elabora el cap d'obra",
    "Els recanvis es troben al magatzem d'equips i la llista l'elabora l'encarregat de manteniment",
    "Els recanvis es troben al magatzem d'obra i la llista l'elabora el cap d'obra",
    "Els recanvis es troben al magatzem general i la llista l'elabora l'encarregat de manteniment",
    ],
    [
    "Què és el <i>lead time</i>?",
    "El temps d'espera entre que es fa una comanda i quan arriba aquesta comanda.",
    "El temps que transcorre entre que l'estoc es troba al nivell màxim fins que està al nivell mínim.",
    "El temps que hi ha entre dues ordres d'aprovisionament consecutives.",
    "El temps de lideratge del director d'obra, és a dir el temps d'execució del projecte.",
    ],
];

let permutacio = "";
const num_preg = preguntes.length;
const num_resp = preguntes[0].length-1;
const fact_np = factorial(num_preg);
const fact_nr = factorial(num_resp);
/*let ordre_preg = Math.floor(aleat(0, fact_np - 1)/1e16)*/;
let ordre_preg = aleat(0, fact_np - 1);

console.log(ordre_preg)
permutacio += ordre_preg + "_";
//ordre_preg *= 1e16;

const preg_ordenades = obtenirPermutacio(preguntes, ordre_preg);

for (let i = 0; i < num_preg; i++){
    p01 += '<p><b>' + (i+1) + '.</b> ' + preg_ordenades[i][0] + '</p>';
    let ordre_resp = aleat (0, fact_nr - 1);
    permutacio += ordre_resp + ".";

    let resp = obtenirPermutacio(preg_ordenades[i].slice(1), ordre_resp);
    p01 += '<ol style="list-style-type: none;">'
    for (let j = 0; j < num_resp; j++){
        p01 += '<li class="preg"><span><i>' + nombreALletra(j+1) +
               '</i>) </span><span style="flex: 1;">' +
               resp[j] + "</span></li>"
    }
    p01 += "</ol>"
}

p02 = permutacio;





// ## 2.2 FUNCIO (actualitzar) ----------------------------------------
// !!! CONVERTIR si és necessari les unitats a les unitats que requereix
// el nostre enunciat.

function estableixParametres(){
    array = [
      p01, p02
    ];
    parametres = parametres.concat(array);  // no tocar aquesta línia
}




// # 3. CALCULS =======================================================

// ## 3.1 CALCUL VALORS (ACTUALITZAR) ---------------------------------
function calcula(){

}





// # D. ENTRENADOR SERVERI ============================================


// # 1. VARIABLES GLOBALS =============================================

let txtEnunciat = "";   // l'enunciat de l'apartat B.
let parametres = [""];  // els paràmetres del punt 3.1.
let solucions = [""];   // els valors que ha donat el programa.
let respostes = [""];   // els valors que ha donat l'alumne.
let alumne = {
    nom: "",
    cicle: "CFGS Técnic Superior en Energies Renovables",
    anys: "2024/2025"
}
let tlog = "";          // log que apareix al final de l'avaluació.



// # 2. FUNCIONS ======================================================




window.onload = function (){
    // txtEnunciat és una variable global
    txtEnunciat = document.getElementById("enunciat").value;
    renderEnunciat(txtEnunciat);
}

function renderEnunciat(){
    let txt = "";
    estableixParametres(); // Va al punt 3.2. de l'apartat C. (script)
    txt = '<h1 align ="center">' + titol + "</h1>\n&nbsp;\n\n" +
          txtEnunciat;
    txt = exportarParametres(txt);
    txt = crearInputs(txt);
    txt = crearIdentificacio(txt);
    document.getElementById("enunciat").innerHTML = txt;
    document.getElementById("titol").innerText = titol;
    texme.renderPage();
}

function exportarParametres(txt){
    let patro = "", canvi = "";
    const fi = parametres.length;
    for (let i = 1; i < parametres.length; i++) {
        patro = "[[p" + i +"]]";
        canvi = parametres[i];
        txt = txt.replace(patro, canvi);
    }
    return txt;
}

function crearInputs(txt){
    let patro = "", canvi = "";
    for (let i = 1; i < puntuacions.length; i++) {
        patro = "[[i" + i +"]]";
        canvi = '<input type="text" onwheel="return false;" ';
        canvi += 'id="i'+ i +'" style="width: 300px">';
        txt = txt.replace(patro, canvi);
    }
    return txt;
}

function crearIdentificacio(txt){
txt += `
<h2>Identificació de l'alumne</h2>

<form id="avalua" onsubmit="event.preventDefault() & avalua()">
    <label>Nom de l'alumne: </label>
    <input id="nom" style="width: 400px"/>
    <div>
        <input type="checkbox" id="informat" required/>
        <label>
            Entenc que al premer el botó avaluar no es pot tornar
            enrera.
        </label>
    </div>
    <br/>
    <div style="text-align: center;">
        <button type="submit" id="boto"
            style="font-size: 20px; color: #AA5050;">
            Avaluar
        </button>
    </div>
</form>
`; return txt;
}

function avalua(){
    importaRespostes();
    resetejar();
    renderAvaluacio();
}

function importaRespostes(){
    respostes[0] = document.getElementById("i1").value
    alumne.nom = document.getElementById("nom").value;
}

function resetejar(){
    const ppal = document.getElementsByTagName("main")[0];
    const body = ppal.parentNode;
    const textArea = body.appendChild(document.createElement("textarea"));
    body.removeChild(ppal);
    textArea.setAttribute("id", "avaluacio");
}

function renderAvaluacio(){
    let txt = "";
    txt += '<h1 align="center"> Avaluació</h1>\n' +
           '<h2 align="center" style="color: #888">' + titol +
           "</h2>\n&nbsp;\n\n"
    txt += [
    "## Presentació de resultats",
    "",
    "L'alumne **[[nom]]**, del [[cicle]] (any [[any]]) serà qualificat manualment.",
    "",
    ].join("\n") + "\n";
    txt += txtEnunciat;

    txt = identificarAlumne(txt);
    txt = puntua(txt);
    txt = txt.replace("## Identificació de l'alumne:\n\n"+
        "[[identificacio]]", "");
    txt +=  "\n" + tlog + "\n";
    document.getElementById("avaluacio").innerHTML = txt;
    texme.renderPage();
}

function identificarAlumne(txt){
    txt = txt.replace("[[nom]]", alumne.nom);
    txt = txt.replace("[[cicle]]", alumne.cicle);
    txt = txt.replace("[[any]]", alumne.anys);
    return txt;
}

function puntua(txt){
    calcula();

    txt = exportarParametres(txt);

    patro = "[[i1]]";
    canvi = "~~~\n    " + respostes[0] + "\n\n\n~~~";

    txt = txt.replace(patro, canvi);

    return txt;
}












function aleat(min, max) { // enter aleat entre min i max (inclosos)
    const a = Math.ceil(min);
    const b = Math.floor(max);
    const c = Math.floor(Math.random() * (b - a + 1) + a);
    return c;
}

function triaElementMatriu (matriu){
    const aleat = Math.floor(Math.random() * (matriu.length));
    return matriu[aleat.toFixed(0)];
}

function factorial(n) {
    return n <= 1 ? 1 : n * factorial(n - 1);
}

// Funció per obtenir la permutació d'un índex específic
function obtenirPermutacio(array, index) {
    let permutacio = [];
    let elements = array.slice(); // Copia de l'array per a evitar
                                  // modificar l'original
    let n = elements.length;

    // Calcular la permutació utilitzant factorials
    for (let i = 0; i < n; i++) {
        let fact = factorial(n - i - 1);
        let posicio = Math.floor(index / fact);
        permutacio.push(elements[posicio]);
        elements.splice(posicio, 1);
        index %= fact;
    }

    return permutacio;
}

function permutacions(array) {

    let resultat = [];

    // Funció recursiva per a generar les permutacions
    function generarPermutacions(actual, resta) {
        if (resta.length === 0) {
            resultat.push(actual);
        } else {
            for (let i = 0; i < resta.length; i++) {
                let actualNova = actual.concat(resta[i]);
                let restaNova = resta.slice(0, i).concat(resta.slice(i + 1));
                generarPermutacions(actualNova, restaNova);
            }
        }
    }

    generarPermutacions([], array);
    return resultat;
}


function nombreALletra(nombre) {
    const ascii = 97; // Código ASCII de 'a'
    if (nombre >= 1 && nombre <= 26) {
        // Convertir el número en el carácter correspondiente usando el código ASCII
        return String.fromCharCode(ascii + nombre - 1);
    } else {
        return null; // Retornar null si el número está fuera de rango
    }
}

</script>
