<!-- A. CAPÇALERA I INITS (NO TOCAR) ============================== -->
<!DOCTYPE html>
<head>
    <title id="titol"></title>
    <link rel="icon" type="image/x-icon" href=img/favicon.png>
    <meta charset="UTF-8">

    <style>
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type=number] {
      -moz-appearance: textfield;
    }

    pre{
        white-space: pre-wrap;
        overflow-wrap: break-word;
    }

    img[alt="c"]{
        display: block;
        margin-left: auto;
        margin-right: auto;
    }
    img[alt="c500"]{
        width: 500px;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }

    img[alt="c250"]{
        width: 250px;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }
    img[alt="250"]{
        width: 250px;
    }
    img[alt="fr350"]{
        width: 350px;
        float: right;
        margin: 0 0 0 0.7em;
    }
    img[alt="fr"]{
        float: right;
        margin: 0 0 0 0.7em;
    }
    img[alt="fl350"]{
        width: 350px;
        float: left;
        margin: 0 .7em 0 0;
    }
    img[alt="fl"]{
        float: left;
        margin: 0 5px 0 0;
    }
    </style>
</head>

<script>
window.texme = {
    renderOnLoad: false,
    markdownURL: 'js/marked/marked.min.js',
    MathJaxURL: 'js/mathjax/es5/tex-mml-chtml.js'
}
</script>
<script src="js/texme/texme.js"></script>

<!-- FI NO TOCAR ================================================== -->




<!-- B. ENUNCIAT ================================================== -->
<textarea id="enunciat">
~~~
&nbsp;
    Permutació: [[p2]]
&nbsp;
~~~

## Normes:
- NO ES PODEN FER PREGUNTES. Si hi ha un error a l'examen es resoldrà
  una vegada acabat, anulant-se la pregunta o rectificant la resposta.
  Si alguna cosa no s'entén es valorarà també una vegada acabat
  l'examen.
- No es poden utilitzar apunts.
- Només es pot tenir una finestra oberta (la del navegador Chrome).
- Només es pot tenir una pestanya oberta (la de l'examen).
- Està terminantment prohibit copiar o mirar al company.
- Per fer preguntes aixequeu la mà, NO US GIREU.
- L'examen dura 150 minuts (2 h 30 min) i es tanca automàticament a les 21:00. ENTREGUEU-HO ABANS o serà un zero.
- Qualsevol incompliment serà sancionat amb un zero.
- Les preguntes correctes sumen 1 punt, les incorrectes resten 1/(numrespostes - 1) punts, les que es deixen en blanc, ni sumen ni resten.

## Com fer aquest examen:
- Agafa paper
- Comença a escriure les respostes al paper.
- Si una resposta es vol deixar en blanc escriu una n.
- Quan acabis copia les respostes sense espais i tot seguit, al camp resposta, si no la saps n. Per exemple: abnaac
- Omple el teu nom i fes click a avaluar.
- Imprimeix la pàgina com a pdf fent «Ctrl + P»
- Adjunta-la com a tasca.
- Fotografia el paper utilitzat (la fotografia és per a tu, per a poder revisar l'examen si ho necessitessis).
- Entrega els papers utilitzats.


## Preguntes

[[p1]]

## Resposta

[[i1]]



</textarea>
<!-- FI ENUNCIAT ================================================== -->







<!-- C. SCRIPT ==================================================== -->
<script>


// # 1. CONSTANTS (actualitzar) ---------------------------------------
const titol = "Test 1 XSBT";
const puntuacions = ["", 10];


// # 2. PARÀMETRES ====================================================

// ## 2.1. DECLARACIÓ (actualitzar) -----------------------------------

let p01 = "";
const preguntes = [

    [
    "En quin tipus de xarxes té millor refrigeració el cable?",
    "Xarxes en canalitzacions entubades",
    "Xarxes directament soterrades",
    "",
    "",
    ],
    [
    "En lo referent a codis de cables, que vol dir Z1?",
    "Policlorur de vinil",
    "Cable flexible",
    "Poliolefina",
    "Polietilè reticulat",
    ],
    [
    "(Monofàsic) La secció del neutre ha de ser:",
    "El 50% de la secció de la fase",
    "Consultar en la taula de la ITC-07",
    "Igual a la secció de la fase",
    "",
    ],
    [
    "A les xarxes dins galeries visitables:",
    "L’aire s’ha de renovar com a mínim 10 vegades per hora",
    "No es permeten canonades d’aigua",
    "No hi poden haver cables de telecomunicacions",
    "No es permeten canonades de gas",
    ],
    [
    "A les xarxes directament soterrades, damunt del cable:",
    "Hi haurà una capa d’arena de mínim 10 cm",
    "Hi haurà una capa d’arena de mínim 5 cm",
    "Hi haurà una capa de formigó de mínim 10 cm",
    "",
    ],
    [
    "En canalitzacions entubades, haurà profunditat mínima fins a la part inferior del tub de:",
    "60 cm en voravies",
    "60 cm en carrers",
    "45 cm en carrers",
    "50 cm en voravies",
    ],
    [
    "En trams rectes de xarxes en canalitzacions entubades, haurà un registre, mínim cada:",
    "50 m",
    "30 m",
    "20 m",
    "40 m",
    ],
    [
    "S’ha de procurar fer els creuaments de forma:",
    "Paral·lela",
    "Perpendicular",
    "",
    "",
    ],
    [
    "En xarxes en canalitzacions entubades en carrers, s’ha de posar:",
    "Formigó als tubs, 3 cm davall y 6 amunt",
    "Arena als tubs, 6 cm davall y 3 cm amunt",
    "Formigó als tubs, 6 cm davall y 3 cm amunt",
    "Arena als tubs, 3 cm davall y 6 amunt",
    ],
    [
    "Quina cantidad de circuits hi pot haver dins d’un tub? ",
    "2",
    "1",
    "3",
    "40 m",
    ],



    [
    "Quina secció mínima ha de tenir el neutre monofàsic?",
    "6 mm2",
    "Igual que la fase",
    "Has de consultar taula 1 ITC-07",
    "16 mm2",
    ],
    [
    "A xarxes directament enterrades quina profunditat mínima fins a la part inferior dels cables?",
    "60 cm en voravies ",
    "60 cm en carrers",
    "80 cm en carrers",
    "80 cm en voravies ",
    ],
    [
    "Allà on es posi el cable es posarà una
    capa d’arena de mínim de:",
    "15 cm",
    "7 cm",
    "10 cm",
    "5 cm",
    ],
    [
    "A canalitzacions entubades es deixan tubs … per  telecos",
    "Vermell",
    "Blau",
    "Groc",
    "Verd",
    ],
    [
    "Creuaments. En vies de tren els cables aniran dins tubs, a una profunditat mínima de:",
    "1,4 m i recoberts de formigó, fins a 1,5 m de les vies.",
    "1,3 m i recoberts de formigó, fins a 1,5 m de les vies.",
    "1,5 m i recoberts de formigó, fins a 1,3 m de les vies.",
    "1,3 m i recoberts de formigó, fins a 1,4 m de les vies.",
    ],
    [
    "Els empalmaments:",
    "es fan com en les xarxes aèries, utilitzant una premsa hidràulica i un maneguet, i recobrint la connexió",
    "es solen fer a dins les caixes generals de protecció o armaris de distribució.",
    "",
    "",
    ],
    [
    "Les avaries solen ser produïdes per:",
    "Augment de la resistència per males connexions.",
    "Connexions mal fetes que provoquen derivacions a terra.",
    "Defectes o talls en la coberta, produïts durant el muntatge.",
    "Totes son certes",
    ],
    [
    "Els cables poden ser:",
    "monofàsic i trifàsic",
    "unipolar o multipolar.",
    "",
    "",
    ],
    [
    "En xarxes en canalitzacions entubades quants circuits pot haver dins cada tub?",
    "4",
    "3",
    "2",
    "1",
    ],
    [
    "Les rases s'han de col·locar cada?",
    "20 m màxim",
    "10 m màxim",
    "40 m màxim",
    "30 m màxim",
    ],

];

/*
2, 3, 3, 4, 1, 2, 4, 2, 1, 2,
2, 1, 4, 4, 2, 1, 4, 2, 4, 3,

*/

let permutacio = "";
const num_preg = preguntes.length;
const num_resp = preguntes[0].length-1;
const fact_np = factorial(num_preg);
const fact_nr = factorial(num_resp);
/*let ordre_preg = Math.floor(aleat(0, fact_np - 1)/1e16)*/;
let ordre_preg = aleat(0, fact_np - 1);

console.log(ordre_preg)
permutacio += ordre_preg + "_";
//ordre_preg *= 1e16;

const preg_ordenades = obtenirPermutacio(preguntes, ordre_preg);

for (let i = 0; i < num_preg; i++){
    p01 += "**" + (i+1) + ".**&nbsp;" + preg_ordenades[i][0] + "<br/>";
    let ordre_resp = aleat (0, fact_nr - 1);
    permutacio += ordre_resp + ".";

    let resp = obtenirPermutacio(preg_ordenades[i].slice(1), ordre_resp);
    for (let j = 0; j < num_resp; j++){
        p01 += "&nbsp;&nbsp;&nbsp;&nbsp;_" + nombreALletra(j+1) + "_)&nbsp;" +
               resp[j] + "<br/>"
    }
    p01 += "<br/>"
}

p02 = permutacio;





// ## 2.2 FUNCIO (actualitzar) ----------------------------------------
// !!! CONVERTIR si és necessari les unitats a les unitats que requereix
// el nostre enunciat.

function estableixParametres(){
    array = [
      p01, p02, /*p03, p04, p05,          p06, p07, p08, p09, p10,
      p11, p12, p13, p14, p15,          p16, p17, p18, p19, p20,
      p21, p22, p23, p24, p25,          p26, p27, p28, p29, p30,
      p31, p32, p33
      */
    ]; // actualitzar entre []
    parametres = parametres.concat(array);  // no tocar aquesta línia
}




// # 3. CALCULS =======================================================

// ## 3.1 CALCUL VALORS (ACTUALITZAR) ---------------------------------
function calcula(){

}





// # D. ENTRENADOR SERVERI ============================================


// # 1. VARIABLES GLOBALS =============================================

let txtEnunciat = "";   // l'enunciat de l'apartat B.
let parametres = [""];  // els paràmetres del punt 3.1.
let solucions = [""];   // els valors que ha donat el programa.
let respostes = [""];   // els valors que ha donat l'alumne.
let alumne = {
    nom: "",
    cicle: "CFGS Tècnic superior en sistemes electrotècnics i automàtics",
    anys: "2024/2025"
}
let tlog = "";          // log que apareix al final de l'avaluació.



// # 2. FUNCIONS ======================================================




window.onload = function (){
    // txtEnunciat és una variable global
    txtEnunciat = document.getElementById("enunciat").value;
    renderEnunciat(txtEnunciat);
}

function renderEnunciat(){
    let txt = "";
    estableixParametres(); // Va al punt 3.2. de l'apartat C. (script)
    txt = '<h1 align ="center">' + titol + "</h1>\n&nbsp;\n\n" +
          txtEnunciat;
    txt = exportarParametres(txt);
    txt = crearInputs(txt);
    txt = crearIdentificacio(txt);
    document.getElementById("enunciat").innerHTML = txt;
    document.getElementById("titol").innerText = titol;
    texme.renderPage();
}

function exportarParametres(txt){
    let patro = "", canvi = "";
    const fi = parametres.length;
    for (let i = 1; i < parametres.length; i++) {
        patro = "[[p" + i +"]]";
        canvi = l(parametres[i]);
        txt = txt.replace(patro, canvi);
    }
    return txt;
}

function crearInputs(txt){
    let patro = "", canvi = "";
    for (let i = 1; i < puntuacions.length; i++) {
        patro = "[[i" + i +"]]";
        canvi = '<input type="text" onwheel="return false;" ';
        canvi += 'id="i'+ i +'" style="width: 300px">';
        txt = txt.replace(patro, canvi);
    }
    return txt;
}

function crearIdentificacio(txt){
txt += `
<h2>Identificació de l'alumne</h2>

<form id="avalua" onsubmit="event.preventDefault() & avalua()">
    <label>Nom de l'alumne: </label>
    <input id="nom" style="width: 400px"/>
    <div>
        <input type="checkbox" id="informat" required/>
        <label>
            Entenc que al premer el botó avaluar no es pot tornar
            enrera.
        </label>
    </div>
    <br/>
    <div style="text-align: center;">
        <button type="submit" id="boto"
            style="font-size: 20px; color: #AA5050;">
            Avaluar
        </button>
    </div>
</form>
`; return txt;
}

function avalua(){
    importaRespostes();
    resetejar();
    renderAvaluacio();
}

function importaRespostes(){
    respostes[0] = document.getElementById("i1").value
    alumne.nom = document.getElementById("nom").value;
    /*let r = [""];
    alumne.nom = document.getElementById("nom").value;  // veure C.2.1
    for (let i = 1; i < puntuacions.length; i++){
        r[i] = document.getElementById("i"+i).value;
    }
    respostes = r.map(xsMap);                           // veure C.2.1
    */
}

function resetejar(){
    const ppal = document.getElementsByTagName("main")[0];
    const body = ppal.parentNode;
    const textArea = body.appendChild(document.createElement("textarea"));
    body.removeChild(ppal);
    textArea.setAttribute("id", "avaluacio");
}

function renderAvaluacio(){
    let txt = "";
    txt += '<h1 align="center"> Avaluació</h1>\n' +
           '<h2 align="center" style="color: #888">' + titol +
           "</h2>\n&nbsp;\n\n"
    txt += [
    "## Presentació de resultats",
    "",
    //"L'alumne **[[nom]]**, del [[cicle]] (any [[any]]) ha obtingut una",
    //"qualificació de:",
    "L'alumne **[[nom]]**, del [[cicle]] (any [[any]]) serà qualificat manualment.",
    "",
    //"> [[nota]]"
    ].join("\n") + "\n";
    txt += txtEnunciat;

    txt = identificarAlumne(txt);
    txt = puntua(txt);
    txt = txt.replace("## Identificació de l'alumne:\n\n"+
        "[[identificacio]]", "");
    txt +=  "\n" + tlog + "\n";
    document.getElementById("avaluacio").innerHTML = txt;
    texme.renderPage();
}

function identificarAlumne(txt){
    txt = txt.replace("[[nom]]", alumne.nom);
    txt = txt.replace("[[cicle]]", alumne.cicle);
    txt = txt.replace("[[any]]", alumne.anys);
    return txt;
}

function puntua(txt){
    calcula();

    txt = exportarParametres(txt);

    patro = "[[i1]]";
    canvi = "~~~\n    " + respostes[0] + "\n\n\n~~~";

    txt = txt.replace(patro, canvi);

    /*
    let ptsAlumne = 0, ptsTotal = 0;
    let canvi = "", patro = "";
    let a = 0, b = 0;
    for (let i = 1; i < puntuacions.length; i++){
        a = respostes[i];
        b = solucions[i];
        ptsTotal += puntuacions[i];
        canvi =
            '<span style="border-bottom: 1px solid silver; padding: 0.2em 1em 0;">'
            + coma(a) + '</span>';
        if ((b*0.99) < a && a < (b*1.01)) {
            ptsAlumne += puntuacions[i];
            canvi +=
                ' <span style="color: green">(' +
                coma(b) +') OK (+' + puntuacions[i] + ')</span>';
        }else{
            canvi +=
                ' <span style="color: red;"> (' +
                coma(b) +')</span>';
        }
        patro = "[[i" + i + "]]";

        txt = txt.replace(patro, canvi);
    }
    txt = txt.replace("[[nota]]", "S'han aconseguit: "+ xs(ptsAlumne, 2) +
        " punts de " + xs(ptsTotal, 2) + " possibles.\n>\n>" +
        "**Nota final: " + xs(ptsAlumne/ptsTotal*10, 2) + "**");
    */
    return txt;
}












function aleat(min, max) { // enter aleat entre min i max (inclosos)
    const a = Math.ceil(min);
    const b = Math.floor(max);
    const c = Math.floor(Math.random() * (b - a + 1) + a);
    return c;
}

function triaElementMatriu (matriu){
    const aleat = Math.floor(Math.random() * (matriu.length));
    return matriu[aleat.toFixed(0)];
}

function factorial(n) {
    return n <= 1 ? 1 : n * factorial(n - 1);
}

// Funció per obtenir la permutació d'un índex específic
function obtenirPermutacio(array, index) {
    let permutacio = [];
    let elements = array.slice(); // Copia de l'array per a evitar
                                  // modificar l'original
    let n = elements.length;

    // Calcular la permutació utilitzant factorials
    for (let i = 0; i < n; i++) {
        let fact = factorial(n - i - 1);
        let posicio = Math.floor(index / fact);
        permutacio.push(elements[posicio]);
        elements.splice(posicio, 1);
        index %= fact;
    }

    return permutacio;
}

function permutacions(array) {

    let resultat = [];

    // Funció recursiva per a generar les permutacions
    function generarPermutacions(actual, resta) {
        if (resta.length === 0) {
            resultat.push(actual);
        } else {
            for (let i = 0; i < resta.length; i++) {
                let actualNova = actual.concat(resta[i]);
                let restaNova = resta.slice(0, i).concat(resta.slice(i + 1));
                generarPermutacions(actualNova, restaNova);
            }
        }
    }

    generarPermutacions([], array);
    return resultat;
}


function atan(a){
    return Math.atan(a)*360/2/π;
}

function sin(a){
    return Math.sin(a*2*π/360);
}

function cos(a){
    return Math.cos(a*2*π/360);
}

function ln(a){
    return Math.log(a);
}

function cbi(x, y){ //complexe input en binomial
    const c = {};
    c.r = (x**2 + y**2)**0.5;
    c.φ = Math.atan2(y, x)*360/2/π;
    c.x = x;
    c.y = y;
    return c;
}

function cpol(r, φ){ //complexe input en polar (φ en graus)
    const c = {};
    c.r = r;
    c.φ = φ;
    c.x = r * cos(φ);
    c.y = r * sin(φ);
    return c;
}

function sumc(a, b){
    return cbi(a.x + b.x, a.y + b.y)
}

function restc(a, b){
    return cbi(a.x - b.x, a.y - b.y)
}

function multc(a, b){
    return cpol(a.r*b.r, a.φ+b.φ);
}

function multc_esc(λ, a){
    return cpol(λ*a.r, a.φ);
}

function divc(a, b){
    return cpol(a.r/b.r, a.φ-b.φ);
}

function invc(a){ // inversa d'un complexe
    return cpol(1/a.r, -a.φ);
}

function logc (nom, v){ // log de un numero complexe
    let log = "";
    log += nom + ": ";
    log += xs(v.x);
    if (v.y > 0) log += " + j" + xs(v.y);
    else if (v.y < 0) log += "-j" + xs(-v.y);
    log += "; ";
    log += xs(v.r) + "∠" + xs(v.φ) + "°\n";
    log = coma(log);
    return log;
}

function logcbi (v){ // log de un numero complexe només en binomial
    let log = "";
    log += xs(v.x);
    if (v.y > 0) log += " + j" + xs(v.y);
    else if (v.y < 0) log += "-j" + xs(-v.y);
    log = coma(log);
    return log;
}

function l(a){  // log abreviat a l totsol
    if (!a.toPrecision) return a;
    return coma(xs(a));
}

function ll(a, b = 4){ // log Latex
    return cl(xs(a, b));
}

function xs(a, b = 4){
    a = Number(a);
    if (a.toPrecision) a = a.toPrecision(b);
    return Number(a);
}

function coma(a){
    a = a + "";
    return a.replaceAll(".", ",");
}

function cl(a){ // coma per a latex
    return coma(a).replaceAll(",", "{,}");
}

function xsMap(a){
    a = xs(a);
    return a;
}


function nombreALletra(nombre) {
    const ascii = 97; // Código ASCII de 'a'
    if (nombre >= 1 && nombre <= 26) {
        // Convertir el número en el carácter correspondiente usando el código ASCII
        return String.fromCharCode(ascii + nombre - 1);
    } else {
        return null; // Retornar null si el número está fuera de rango
    }
}

</script>














<!--
/**********************************************************************
 * - Establir les puntuacions, que han de correspondre amb la quantitat
 * de respostes que l'alumne pot contestar.
 *
 * - Establir els paràmetres. En general serà una funció per a generar
 * nombres aleatoris, però també es poden fixar. Aquest últim cas és
 * interessant per a testejar els càlculs. IMPORTANT: Al finalitzar
 * tots els parametres hauran de concatenarse al vector parametres.
 *
 * -  El mateix succeeix amb els càlculs. Tot haura de volcar-se al
 * vector solucions.
 * *******************************************************************/
-->
